<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page plugin-docs plugin-id-default docs-doc-id-guides/sre/keeper/index" data-has-hydrated=false><script>(function(){try{window.__cfbm=Object.freeze({"score":1,"verified":false,"category":"","bucket":"automated"});window.sessionStorage.setItem('__cfbm', JSON.stringify(window.__cfbm));}catch(e){}})();</script><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>ClickHouse Keeper | ClickHouse Docs</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://clickhouse.com/docs/img/docs_social_share.png><meta data-rh=true name=twitter:image content=https://clickhouse.com/docs/img/docs_social_share.png><meta data-rh=true property=og:url content=https://clickhouse.com/docs/guides/sre/keeper/clickhouse-keeper><meta data-rh=true property=og:locale content=en><meta data-rh=true property=og:locale:alternate content=jp><meta data-rh=true property=og:locale:alternate content=zh><meta data-rh=true property=og:locale:alternate content=ru><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=Accept-Language content="en-US,en;q=0.9"><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="ClickHouse Keeper | ClickHouse Docs"><meta data-rh=true name=description content="ClickHouse Keeper, or clickhouse-keeper, replaces ZooKeeper and provides replication and coordination."><meta data-rh=true property=og:description content="ClickHouse Keeper, or clickhouse-keeper, replaces ZooKeeper and provides replication and coordination."><meta data-rh=true name=keywords content=Keeper,ZooKeeper,clickhouse-keeper><link data-rh=true rel=icon href=/docs/img/docs_favicon.ico><link data-rh=true rel=canonical href=https://clickhouse.com/docs/guides/sre/keeper/clickhouse-keeper><link data-rh=true rel=alternate href=https://clickhouse.com/docs/guides/sre/keeper/clickhouse-keeper hreflang=en><link data-rh=true rel=alternate href=https://clickhouse.com/docs/jp/guides/sre/keeper/clickhouse-keeper hreflang=jp><link data-rh=true rel=alternate href=https://clickhouse.com/docs/zh/guides/sre/keeper/clickhouse-keeper hreflang=zh><link data-rh=true rel=alternate href=https://clickhouse.com/docs/ru/guides/sre/keeper/clickhouse-keeper hreflang=ru><link data-rh=true rel=alternate href=https://clickhouse.com/docs/guides/sre/keeper/clickhouse-keeper hreflang=x-default><link data-rh=true rel=preconnect href=https://5H9UG7CX5W-dsn.algolia.net crossorigin=anonymous><link rel=alternate type=application/rss+xml href=/docs/knowledgebase/rss.xml title="ClickHouse Knowledge Base Feed RSS Feed"><link rel=alternate type=application/atom+xml href=/docs/knowledgebase/atom.xml title="ClickHouse Knowledge Base Feed Atom Feed"><link rel=alternate type=application/json href=/docs/knowledgebase/feed.json title="ClickHouse Knowledge Base Feed JSON Feed"><link rel=preconnect href=https://www.googletagmanager.com><script>window.dataLayer=window.dataLayer||[],function(e,t,a,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var d=t.getElementsByTagName(a)[0],g=t.createElement(a);g.async=!0,g.src="https://www.googletagmanager.com/gtm.js?id="+r+("dataLayer"!=n?"&l="+n:""),d.parentNode.insertBefore(g,d)}(window,document,"script","dataLayer","GTM-WTNTDT7W")</script><link rel=search type=application/opensearchdescription+xml title="ClickHouse Docs" href=/docs/opensearch.xml><link href=https://widget.kapa.ai rel=preconnect><link href=https://www.gstatic.com rel=preconnect crossorigin=use-credentials><link href=https://www.googletagmanager.com rel=preconnect><script src=/docs/js/kapa_config.js></script><script src=/docs/js/kapa_widget.js async defer></script><link rel=stylesheet href=/docs/assets/css/styles.eafcc97c.css><script src=/docs/assets/js/runtime~main.047e91c7.js defer></script><script src=/docs/assets/js/main.a75c5b65.js defer></script><body class=navigation-with-keyboard><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WTNTDT7W" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript>


<script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top navBar_gvJn"><div class="navbarHeaderContainer_hXE4 navbar-header"><div class="navbar__inner navbarInner_AsTO"><div class=navbarLogo_UJMW><a href=https://clickhouse.com/ target=_blank rel="noopener noreferrer" class=navbar__brand><div class=navbar__logo><img src=/docs/img/ch_logo_docs.svg alt=ClickHouse class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/docs/img/ch_logo_docs_dark.svg alt=ClickHouse class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><nav class="ch-nav-v2 ch-nav-v2-desktop-item"><div><ul><li><div class="ch-nav-v2-item "><a href="" class="ch-nav-v2-link  has-children  undefined "><span>Products</span><span class=chevron><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron right mobile-chevron "><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron down desktop-chevron "><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg></span></a><div class="ch-nav-v2-item__children "><div class=""><ul class="ch-nav-v2-sub-nav-products ch-nav-v2-list"><li><a href=https://clickhouse.com/cloud class="ch-nav-v2-link nav-with-icon "><div class=icon><svg xmlns=http://www.w3.org/2000/svg width=23 height=17 viewBox="0 0 23 17"><path fill=currentColor d="M14.5.25a8.25 8.25 0 0 1 .252 16.496l-.252.004H6.25a6 6 0 1 1 .601-11.97l.268.031.03-.06A8.25 8.25 0 0 1 14.248.254zm0 1.5A6.75 6.75 0 0 0 7.75 8.5a.75.75 0 0 1-1.5 0q.002-.951.206-1.841l.101-.399-.307-.01a4.5 4.5 0 0 0-.212 8.995l.212.005h8.25a6.75 6.75 0 1 0 0-13.5"/></svg></div><span>ClickHouse Cloud<div class=nav-with-icon__description>Best way to use ClickHouse.<br>Available on AWS, GCP, and Azure.</div></span></a><li><a href=https://clickhouse.com/cloud/bring-your-own-cloud class="ch-nav-v2-link nav-with-icon "><div class=icon><svg xmlns=http://www.w3.org/2000/svg width=24 height=24 fill=none viewBox="0 0 24 24"><path stroke=currentColor stroke-width=1.5 d="M2.106 11.782A5.24 5.24 0 0 1 6.742 8.99c.438 0 .875.053 1.301.159m-.552 2.837a7.49 7.49 0 1 1 7.49 7.49h-8.24a5.24 5.24 0 0 1-4.188-2.088"/><path fill=currentColor d="M12.76 13.8h-12v1.4h12z"/><path fill=currentColor fill-rule=evenodd d="m15.26 14.5-2.5 2.5v-5z" clip-rule=evenodd /></svg></div><span>BYOC (Bring Your Own Cloud)<div class=nav-with-icon__description>The fully managed ClickHouse Cloud service,<br>Can be deployed in your AWS account.</div></span></a><li><a href=https://clickhouse.com/clickhouse class="ch-nav-v2-link nav-with-icon "><div class=icon><svg xmlns=http://www.w3.org/2000/svg width=16 height=17 viewBox="0 0 16 17"><path fill=currentColor d="M14.564 9.25c.75 0 1.324.615 1.39 1.36l.006.14v4.5c0 .758-.53 1.418-1.258 1.493l-.138.007H1.646c-.751 0-1.325-.615-1.39-1.36l-.006-.14v-4.5c0-.758.53-1.418 1.257-1.493l.139-.007zm-.104 1.5H1.75v4.5h12.71zm.104-10.5c.75 0 1.324.615 1.39 1.36l.006.14v4.5c0 .758-.53 1.418-1.258 1.493l-.138.007H1.646C.895 7.75.32 7.135.256 6.39L.25 6.25v-4.5C.25.992.78.332 1.507.257L1.646.25zm-.104 1.5H1.75v4.5h12.71z"/></svg></div><span>ClickHouse<div class=nav-with-icon__description>Set up a database with open-source ClickHouse.<br>ClickHouse</div></span></a><li class=ch-nav-v2-mobile-item><a href=https://clickhouse.com/integrations class="ch-nav-v2-link nav-with-icon "><div class=icon><svg xmlns=http://www.w3.org/2000/svg width=21 height=21 viewBox="0 0 21 21"><path fill=currentColor d="m20.754 14.577.006.1v3.221a2.86 2.86 0 0 1-2.655 2.855l-.207.007-3.208.002c-.35.002-.704-.222-.756-.642l-.007-.109a1 1 0 0 1 .007-.102l.008-.047c.056-.28.05-.568-.018-.845l-.048-.164a1.86 1.86 0 0 0-1.311-1.203 1.895 1.895 0 0 0-2.327 2.213.75.75 0 0 1-.636.892l-.1.006h-3.22a2.86 2.86 0 0 1-2.856-2.693l-.005-.169-.001-2.426-.194-.018a3.4 3.4 0 0 1-2.13-1.127l-.133-.161a3.4 3.4 0 0 1-.608-2.918A3.36 3.36 0 0 1 3.19 8.73l.229-.022V6.283c0-.69.25-1.355.698-1.873l.14-.151a2.86 2.86 0 0 1 1.818-.83l.207-.008 2.425-.001.019-.194a3.4 3.4 0 0 1 1.127-2.13l.161-.133a3.4 3.4 0 0 1 2.919-.608 3.365 3.365 0 0 1 2.518 2.835l.021.23h2.426c.69 0 1.355.25 1.873.698l.151.14c.488.489.782 1.135.83 1.818l.008.207V9.49c.003.35-.22.704-.64.756l-.11.007a1 1 0 0 1-.102-.007l-.047-.009a1.95 1.95 0 0 0-.845.019l-.164.048a1.86 1.86 0 0 0-1.203 1.311 1.895 1.895 0 0 0 2.087 2.348l.192-.031.099-.005.046.003.108.016.068.02.112.048.064.038.073.056.047.043a.74.74 0 0 1 .188.327l.02.1Zm-9.82-12.43a1.89 1.89 0 0 0-.696 1.876.75.75 0 0 1-.635.891l-.1.007H6.282a1.36 1.36 0 0 0-1.354 1.208l-.008.154-.001 3.178.002.03c.003.35-.221.704-.641.756l-.11.007a1 1 0 0 1-.102-.007l-.046-.009a1.96 1.96 0 0 0-.845.019l-.164.048a1.86 1.86 0 0 0-1.204 1.311 1.895 1.895 0 0 0 2.214 2.327.75.75 0 0 1 .891.635l.007.1v3.221c0 .708.54 1.29 1.23 1.355l.132.006 2.424.001.019-.194a3.4 3.4 0 0 1 1.127-2.13l.161-.134a3.4 3.4 0 0 1 2.918-.607 3.36 3.36 0 0 1 2.519 2.835l.021.229h2.426c.31 0 .609-.105.849-.296l.114-.102c.22-.22.356-.505.39-.81l.009-.154-.001-2.426-.193-.018a3.4 3.4 0 0 1-2.13-1.127l-.134-.161a3.4 3.4 0 0 1-.607-2.918 3.36 3.36 0 0 1 2.835-2.519l.229-.022.001-2.433-.008-.145a1.36 1.36 0 0 0-.288-.695l-.102-.114a1.36 1.36 0 0 0-.81-.39l-.154-.01h-3.221a.75.75 0 0 1-.735-.898 1.94 1.94 0 0 0-.065-1.009 1.87 1.87 0 0 0-1.312-1.204 1.9 1.9 0 0 0-1.631.339Z"/></svg></div><span>Discover more than 100 integrations.</span></a></ul><a href=https://clickhouse.com/integrations style=padding-left:60px class="LinkWithArrow_gmJP ch-nav-v2-desktop-item ch-nav-v2-link-with-arrow">Discover more than 100 integrations.<!-- --> <span class=LinkWithArrow__Arrow_QCtL><span class=LinkWithArrow__ArrowGhost_fSw7><svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 16 16" class=LinkWithArrow__ArrowSvg_EHFy><path fill=currentColor fill-rule=nonzero d="m8.613.21.094.083 7 7c.029.028.055.059.08.09l-.08-.09a1.008 1.008 0 0 1 .292.675L16 8v.033l-.004.052L16 8a1.008 1.008 0 0 1-.22.625l-.073.082-7 7a1 1 0 0 1-1.497-1.32l.083-.094L12.585 9H1a1 1 0 0 1-.117-1.993L1 7h11.585L7.293 1.707A1 1 0 0 1 7.21.387l.083-.094A1 1 0 0 1 8.613.21Z"/></svg></span><span class=LinkWithArrow__ArrowVisible_ZvLF><svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 16 16" class=LinkWithArrow__ArrowSvg_EHFy><path fill=currentColor fill-rule=nonzero d="m8.613.21.094.083 7 7c.029.028.055.059.08.09l-.08-.09a1.008 1.008 0 0 1 .292.675L16 8v.033l-.004.052L16 8a1.008 1.008 0 0 1-.22.625l-.073.082-7 7a1 1 0 0 1-1.497-1.32l.083-.094L12.585 9H1a1 1 0 0 1-.117-1.993L1 7h11.585L7.293 1.707A1 1 0 0 1 7.21.387l.083-.094A1 1 0 0 1 8.613.21Z"/></svg></span></span></a></div></div></div><li><div class="ch-nav-v2-item "><a href="" class="ch-nav-v2-link  has-children  undefined "><span>Use cases</span><span class=chevron><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron right mobile-chevron "><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron down desktop-chevron "><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg></span></a><div class="ch-nav-v2-item__children "><div class=""><ul class="ch-nav-v2-sub-nav-use-cases ch-nav-v2-list"><li><a href=https://clickhouse.com/use-cases/real-time-analytics class="ch-nav-v2-link  ">Real-time analytics</a><li><a href=https://clickhouse.com/use-cases/machine-learning-and-data-science class="ch-nav-v2-link  ">Machine Learning & Generative AI</a><li><a href=https://clickhouse.com/use-cases/data-warehousing class="ch-nav-v2-link  ">Business Intelligence</a><li><a href=https://clickhouse.com/use-cases/observability class="ch-nav-v2-link  ">Logs, Events, Traces</a><li class=ch-nav-v2-mobile-item><a href=https://clickhouse.com/use-cases class="ch-nav-v2-link  ">All use cases</a></ul><a href=https://clickhouse.com/use-cases class="LinkWithArrow_gmJP ch-nav-v2-desktop-item ch-nav-v2-link-with-arrow">All use cases<!-- --> <span class=LinkWithArrow__Arrow_QCtL><span class=LinkWithArrow__ArrowGhost_fSw7><svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 16 16" class=LinkWithArrow__ArrowSvg_EHFy><path fill=currentColor fill-rule=nonzero d="m8.613.21.094.083 7 7c.029.028.055.059.08.09l-.08-.09a1.008 1.008 0 0 1 .292.675L16 8v.033l-.004.052L16 8a1.008 1.008 0 0 1-.22.625l-.073.082-7 7a1 1 0 0 1-1.497-1.32l.083-.094L12.585 9H1a1 1 0 0 1-.117-1.993L1 7h11.585L7.293 1.707A1 1 0 0 1 7.21.387l.083-.094A1 1 0 0 1 8.613.21Z"/></svg></span><span class=LinkWithArrow__ArrowVisible_ZvLF><svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 16 16" class=LinkWithArrow__ArrowSvg_EHFy><path fill=currentColor fill-rule=nonzero d="m8.613.21.094.083 7 7c.029.028.055.059.08.09l-.08-.09a1.008 1.008 0 0 1 .292.675L16 8v.033l-.004.052L16 8a1.008 1.008 0 0 1-.22.625l-.073.082-7 7a1 1 0 0 1-1.497-1.32l.083-.094L12.585 9H1a1 1 0 0 1-.117-1.993L1 7h11.585L7.293 1.707A1 1 0 0 1 7.21.387l.083-.094A1 1 0 0 1 8.613.21Z"/></svg></span></span></a></div></div></div><li><div class="ch-nav-v2-item "><a href=https://clickhouse.com/docs class="ch-nav-v2-link    undefined "><span>Documentation</span></a></div><li><div class="ch-nav-v2-item "><a href="" class="ch-nav-v2-link  has-children  undefined "><span>Resources</span><span class=chevron><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron right mobile-chevron "><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron down desktop-chevron "><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg></span></a><div class="ch-nav-v2-item__children "><div class=""><ul class="ch-nav-v2-sub-nav-resources ch-nav-v2-list"><li><a href=https://clickhouse.com/user-stories class="ch-nav-v2-link  ">User stories</a><li><a href=https://clickhouse.com/blog class="ch-nav-v2-link  ">Blog</a><li><a href=https://clickhouse.com/company/events class="ch-nav-v2-link  ">Events</a><li><a href=https://clickhouse.com/learn class="ch-nav-v2-link  ">Learning and certification</a><li><a href="" class="ch-nav-v2-link w-full items-center justify-between  "><span>Comparison</span><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron right text-neutral-500"><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg></a><ul class="ch-nav-v2-sub-nav ch-nav-v2-list "><li><a href=https://clickhouse.com/comparison/bigquery class="ch-nav-v2-link block w-full ">BigQuery</a><li><a href=https://clickhouse.com/comparison/postgresql class="ch-nav-v2-link block w-full ">PostgreSQL</a><li><a href=https://clickhouse.com/comparison/redshift class="ch-nav-v2-link block w-full ">Redshift</a><li><a href=https://clickhouse.com/comparison/rockset class="ch-nav-v2-link block w-full ">Rockset</a><li><a href=https://clickhouse.com/comparison/snowflake class="ch-nav-v2-link block w-full ">Snowflake</a></ul><li><a href=https://clickhouse.com/videos class="ch-nav-v2-link block w-full ">Video</a><li><a href=https://clickhouse.com/demos class="ch-nav-v2-link block w-full ">Demo</a></ul></div></div></div><li><div class="ch-nav-v2-item "><a href=/pricing class="ch-nav-v2-link    undefined "><span>Pricing</span></a></div><li><div class="ch-nav-v2-item "><a href="/company/contact?loc=nav" class="ch-nav-v2-link    undefined "><span>Contact</span></a></div></ul></div></nav><div class=navRight_Xotf><a href="https://github.com/ClickHouse/ClickHouse?utm_source=clickhouse&utm_medium=website&utm_campaign=website-nav" target=_blank class=githubStars_xKU0><div class=githubStarsContainer_fzg6><svg width=16 height=16 viewBox="0 0 16 16" fill=none xmlns=http://www.w3.org/2000/svg><path fill-rule=evenodd clip-rule=evenodd d="M8 1.75C4.27062 1.75 1.25 4.77062 1.25 8.5C1.25 11.4869 3.18219 14.0097 5.86531 14.9041C6.20281 14.9631 6.32937 14.7606 6.32937 14.5834C6.32937 14.4231 6.32094 13.8916 6.32094 13.3263C4.625 13.6384 4.18625 12.9128 4.05125 12.5331C3.97531 12.3391 3.64625 11.74 3.35938 11.5797C3.12312 11.4531 2.78562 11.1409 3.35094 11.1325C3.8825 11.1241 4.26219 11.6219 4.38875 11.8244C4.99625 12.8453 5.96656 12.5584 6.35469 12.3813C6.41375 11.9425 6.59094 11.6472 6.785 11.4784C5.28312 11.3097 3.71375 10.7275 3.71375 8.14563C3.71375 7.41156 3.97531 6.80406 4.40563 6.33156C4.33812 6.16281 4.10187 5.47094 4.47312 4.54281C4.47312 4.54281 5.03844 4.36563 6.32937 5.23469C6.86937 5.08281 7.44313 5.00687 8.01688 5.00687C8.59063 5.00687 9.16438 5.08281 9.70438 5.23469C10.9953 4.35719 11.5606 4.54281 11.5606 4.54281C11.9319 5.47094 11.6956 6.16281 11.6281 6.33156C12.0584 6.80406 12.32 7.40312 12.32 8.14563C12.32 10.7359 10.7422 11.3097 9.24031 11.4784C9.485 11.6894 9.69594 12.0944 9.69594 12.7272C9.69594 13.63 9.6875 14.3556 9.6875 14.5834C9.6875 14.7606 9.81406 14.9716 10.1516 14.9041C12.8178 14.0097 14.75 11.4784 14.75 8.5C14.75 4.77062 11.7294 1.75 8 1.75Z" fill=currentColor /></svg><span class=githubText_pqqB>46.0k</span></div></a><div class=mobileSearchBar_lGd9><a href=/docs/search class="DocSearch DocSearch-Button" aria-label=Search><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys><kbd class=DocSearch-Button-Key>Ctrl</kbd><kbd class=DocSearch-Button-Key>K</kbd></span></a></div><div class=signUp_pDjn><a href="https://console.clickhouse.cloud/signIn?loc=docs-nav-signIn-cta" class="sign-in navbar__link ch-menu signIn_n8kr">Sign in</a><a href="https://console.clickhouse.cloud/signUp?loc=docs-nav-signUp-cta" class=click-button-anchor><button class="click-button primary-btn">Get started</button></a></div><svg class=docsNavBurger_SkeB width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></div></div><div class="secondary-nav--items secondaryMenu_SZAs"><div class=dropdownCategoriesContainer_DwBX><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/introduction-clickhouse>Get started</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/cloud/overview>Cloud</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/updating-data>Manage data</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/guides/manage-and-deploy-index>Server admin</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/sql-reference>Reference</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/integrations>Integrations</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/use-cases/observability/clickstack/overview>ClickStack</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/chdb>chDB</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/about>About</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class=docsNavDropdownContainer_cADf><a class=docsNavDropdownToolbarTopLevelLink_lJY0 href=/docs/knowledgebase><span>Knowledge Base</span></a></div></div><div class="secondaryMenuRight_dXHH secondary-nav--items-right"><div class="navbar__item dropdown dropdown--hoverable"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_DSK9><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>English</a><ul class=dropdown__menu><li><a href=/docs/guides/sre/keeper/clickhouse-keeper target=_self rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=en>English</a><li><a href=/docs/jp/guides/sre/keeper/clickhouse-keeper target=_self rel="noopener noreferrer" class=dropdown__link lang=jp>日本語</a><li><a href=/docs/zh/guides/sre/keeper/clickhouse-keeper target=_self rel="noopener noreferrer" class=dropdown__link lang=zh>中文</a><li><a href=/docs/ru/guides/sre/keeper/clickhouse-keeper target=_self rel="noopener noreferrer" class=dropdown__link lang=ru>Русский</a></ul></div><button class="colorModeButton_EOjh navbar-color-toggle"><svg xmlns=http://www.w3.org/2000/svg fill=none width=31 height=31 viewBox="0 0 24 24" stroke-width=1.5 stroke=currentColor class="w-6 h-6" stroke-linecap=round stroke-linejoin=round><path stroke-linecap=round stroke-linejoin=round d="M18.3945 13.0269C18.7245 12.8719 19.0765 13.1969 18.9845 13.5499C18.6705 14.7519 18.0535 15.8959 17.1035 16.8459C14.2825 19.6669 9.76953 19.7259 7.02153 16.9779C4.27353 14.2299 4.33353 9.71589 7.15453 6.89489C8.10453 5.94489 9.24753 5.32789 10.4505 5.01389C10.8035 4.92189 11.1275 5.27389 10.9735 5.60389C9.97153 7.74289 10.3005 10.3049 11.9975 12.0019C13.6935 13.6999 16.2555 14.0289 18.3945 13.0269V13.0269Z"/></svg></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top navBar_gvJn"><div class="navbarHeaderContainer_hXE4 navbar-header"><div class="navbar__inner navbarInner_AsTO"><div class=navbarLogo_UJMW><a href=https://clickhouse.com/ target=_blank rel="noopener noreferrer" class=navbar__brand><div class=navbar__logo><img src=/docs/img/ch_logo_docs.svg alt=ClickHouse class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/docs/img/ch_logo_docs_dark.svg alt=ClickHouse class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><nav class="ch-nav-v2 ch-nav-v2-desktop-item"><div><ul><li><div class="ch-nav-v2-item "><a href="" class="ch-nav-v2-link  has-children  undefined "><span>Products</span><span class=chevron><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron right mobile-chevron "><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron down desktop-chevron "><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg></span></a><div class="ch-nav-v2-item__children "><div class=""><ul class="ch-nav-v2-sub-nav-products ch-nav-v2-list"><li><a href=https://clickhouse.com/cloud class="ch-nav-v2-link nav-with-icon "><div class=icon><svg xmlns=http://www.w3.org/2000/svg width=23 height=17 viewBox="0 0 23 17"><path fill=currentColor d="M14.5.25a8.25 8.25 0 0 1 .252 16.496l-.252.004H6.25a6 6 0 1 1 .601-11.97l.268.031.03-.06A8.25 8.25 0 0 1 14.248.254zm0 1.5A6.75 6.75 0 0 0 7.75 8.5a.75.75 0 0 1-1.5 0q.002-.951.206-1.841l.101-.399-.307-.01a4.5 4.5 0 0 0-.212 8.995l.212.005h8.25a6.75 6.75 0 1 0 0-13.5"/></svg></div><span>ClickHouse Cloud<div class=nav-with-icon__description>Best way to use ClickHouse.<br>Available on AWS, GCP, and Azure.</div></span></a><li><a href=https://clickhouse.com/cloud/bring-your-own-cloud class="ch-nav-v2-link nav-with-icon "><div class=icon><svg xmlns=http://www.w3.org/2000/svg width=24 height=24 fill=none viewBox="0 0 24 24"><path stroke=currentColor stroke-width=1.5 d="M2.106 11.782A5.24 5.24 0 0 1 6.742 8.99c.438 0 .875.053 1.301.159m-.552 2.837a7.49 7.49 0 1 1 7.49 7.49h-8.24a5.24 5.24 0 0 1-4.188-2.088"/><path fill=currentColor d="M12.76 13.8h-12v1.4h12z"/><path fill=currentColor fill-rule=evenodd d="m15.26 14.5-2.5 2.5v-5z" clip-rule=evenodd /></svg></div><span>BYOC (Bring Your Own Cloud)<div class=nav-with-icon__description>The fully managed ClickHouse Cloud service,<br>Can be deployed in your AWS account.</div></span></a><li><a href=https://clickhouse.com/clickhouse class="ch-nav-v2-link nav-with-icon "><div class=icon><svg xmlns=http://www.w3.org/2000/svg width=16 height=17 viewBox="0 0 16 17"><path fill=currentColor d="M14.564 9.25c.75 0 1.324.615 1.39 1.36l.006.14v4.5c0 .758-.53 1.418-1.258 1.493l-.138.007H1.646c-.751 0-1.325-.615-1.39-1.36l-.006-.14v-4.5c0-.758.53-1.418 1.257-1.493l.139-.007zm-.104 1.5H1.75v4.5h12.71zm.104-10.5c.75 0 1.324.615 1.39 1.36l.006.14v4.5c0 .758-.53 1.418-1.258 1.493l-.138.007H1.646C.895 7.75.32 7.135.256 6.39L.25 6.25v-4.5C.25.992.78.332 1.507.257L1.646.25zm-.104 1.5H1.75v4.5h12.71z"/></svg></div><span>ClickHouse<div class=nav-with-icon__description>Set up a database with open-source ClickHouse.<br>ClickHouse</div></span></a><li class=ch-nav-v2-mobile-item><a href=https://clickhouse.com/integrations class="ch-nav-v2-link nav-with-icon "><div class=icon><svg xmlns=http://www.w3.org/2000/svg width=21 height=21 viewBox="0 0 21 21"><path fill=currentColor d="m20.754 14.577.006.1v3.221a2.86 2.86 0 0 1-2.655 2.855l-.207.007-3.208.002c-.35.002-.704-.222-.756-.642l-.007-.109a1 1 0 0 1 .007-.102l.008-.047c.056-.28.05-.568-.018-.845l-.048-.164a1.86 1.86 0 0 0-1.311-1.203 1.895 1.895 0 0 0-2.327 2.213.75.75 0 0 1-.636.892l-.1.006h-3.22a2.86 2.86 0 0 1-2.856-2.693l-.005-.169-.001-2.426-.194-.018a3.4 3.4 0 0 1-2.13-1.127l-.133-.161a3.4 3.4 0 0 1-.608-2.918A3.36 3.36 0 0 1 3.19 8.73l.229-.022V6.283c0-.69.25-1.355.698-1.873l.14-.151a2.86 2.86 0 0 1 1.818-.83l.207-.008 2.425-.001.019-.194a3.4 3.4 0 0 1 1.127-2.13l.161-.133a3.4 3.4 0 0 1 2.919-.608 3.365 3.365 0 0 1 2.518 2.835l.021.23h2.426c.69 0 1.355.25 1.873.698l.151.14c.488.489.782 1.135.83 1.818l.008.207V9.49c.003.35-.22.704-.64.756l-.11.007a1 1 0 0 1-.102-.007l-.047-.009a1.95 1.95 0 0 0-.845.019l-.164.048a1.86 1.86 0 0 0-1.203 1.311 1.895 1.895 0 0 0 2.087 2.348l.192-.031.099-.005.046.003.108.016.068.02.112.048.064.038.073.056.047.043a.74.74 0 0 1 .188.327l.02.1Zm-9.82-12.43a1.89 1.89 0 0 0-.696 1.876.75.75 0 0 1-.635.891l-.1.007H6.282a1.36 1.36 0 0 0-1.354 1.208l-.008.154-.001 3.178.002.03c.003.35-.221.704-.641.756l-.11.007a1 1 0 0 1-.102-.007l-.046-.009a1.96 1.96 0 0 0-.845.019l-.164.048a1.86 1.86 0 0 0-1.204 1.311 1.895 1.895 0 0 0 2.214 2.327.75.75 0 0 1 .891.635l.007.1v3.221c0 .708.54 1.29 1.23 1.355l.132.006 2.424.001.019-.194a3.4 3.4 0 0 1 1.127-2.13l.161-.134a3.4 3.4 0 0 1 2.918-.607 3.36 3.36 0 0 1 2.519 2.835l.021.229h2.426c.31 0 .609-.105.849-.296l.114-.102c.22-.22.356-.505.39-.81l.009-.154-.001-2.426-.193-.018a3.4 3.4 0 0 1-2.13-1.127l-.134-.161a3.4 3.4 0 0 1-.607-2.918 3.36 3.36 0 0 1 2.835-2.519l.229-.022.001-2.433-.008-.145a1.36 1.36 0 0 0-.288-.695l-.102-.114a1.36 1.36 0 0 0-.81-.39l-.154-.01h-3.221a.75.75 0 0 1-.735-.898 1.94 1.94 0 0 0-.065-1.009 1.87 1.87 0 0 0-1.312-1.204 1.9 1.9 0 0 0-1.631.339Z"/></svg></div><span>Discover more than 100 integrations.</span></a></ul><a href=https://clickhouse.com/integrations style=padding-left:60px class="LinkWithArrow_gmJP ch-nav-v2-desktop-item ch-nav-v2-link-with-arrow">Discover more than 100 integrations.<!-- --> <span class=LinkWithArrow__Arrow_QCtL><span class=LinkWithArrow__ArrowGhost_fSw7><svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 16 16" class=LinkWithArrow__ArrowSvg_EHFy><path fill=currentColor fill-rule=nonzero d="m8.613.21.094.083 7 7c.029.028.055.059.08.09l-.08-.09a1.008 1.008 0 0 1 .292.675L16 8v.033l-.004.052L16 8a1.008 1.008 0 0 1-.22.625l-.073.082-7 7a1 1 0 0 1-1.497-1.32l.083-.094L12.585 9H1a1 1 0 0 1-.117-1.993L1 7h11.585L7.293 1.707A1 1 0 0 1 7.21.387l.083-.094A1 1 0 0 1 8.613.21Z"/></svg></span><span class=LinkWithArrow__ArrowVisible_ZvLF><svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 16 16" class=LinkWithArrow__ArrowSvg_EHFy><path fill=currentColor fill-rule=nonzero d="m8.613.21.094.083 7 7c.029.028.055.059.08.09l-.08-.09a1.008 1.008 0 0 1 .292.675L16 8v.033l-.004.052L16 8a1.008 1.008 0 0 1-.22.625l-.073.082-7 7a1 1 0 0 1-1.497-1.32l.083-.094L12.585 9H1a1 1 0 0 1-.117-1.993L1 7h11.585L7.293 1.707A1 1 0 0 1 7.21.387l.083-.094A1 1 0 0 1 8.613.21Z"/></svg></span></span></a></div></div></div><li><div class="ch-nav-v2-item "><a href="" class="ch-nav-v2-link  has-children  undefined "><span>Use cases</span><span class=chevron><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron right mobile-chevron "><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron down desktop-chevron "><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg></span></a><div class="ch-nav-v2-item__children "><div class=""><ul class="ch-nav-v2-sub-nav-use-cases ch-nav-v2-list"><li><a href=https://clickhouse.com/use-cases/real-time-analytics class="ch-nav-v2-link  ">Real-time analytics</a><li><a href=https://clickhouse.com/use-cases/machine-learning-and-data-science class="ch-nav-v2-link  ">Machine Learning & Generative AI</a><li><a href=https://clickhouse.com/use-cases/data-warehousing class="ch-nav-v2-link  ">Business Intelligence</a><li><a href=https://clickhouse.com/use-cases/observability class="ch-nav-v2-link  ">Logs, Events, Traces</a><li class=ch-nav-v2-mobile-item><a href=https://clickhouse.com/use-cases class="ch-nav-v2-link  ">All use cases</a></ul><a href=https://clickhouse.com/use-cases class="LinkWithArrow_gmJP ch-nav-v2-desktop-item ch-nav-v2-link-with-arrow">All use cases<!-- --> <span class=LinkWithArrow__Arrow_QCtL><span class=LinkWithArrow__ArrowGhost_fSw7><svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 16 16" class=LinkWithArrow__ArrowSvg_EHFy><path fill=currentColor fill-rule=nonzero d="m8.613.21.094.083 7 7c.029.028.055.059.08.09l-.08-.09a1.008 1.008 0 0 1 .292.675L16 8v.033l-.004.052L16 8a1.008 1.008 0 0 1-.22.625l-.073.082-7 7a1 1 0 0 1-1.497-1.32l.083-.094L12.585 9H1a1 1 0 0 1-.117-1.993L1 7h11.585L7.293 1.707A1 1 0 0 1 7.21.387l.083-.094A1 1 0 0 1 8.613.21Z"/></svg></span><span class=LinkWithArrow__ArrowVisible_ZvLF><svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 16 16" class=LinkWithArrow__ArrowSvg_EHFy><path fill=currentColor fill-rule=nonzero d="m8.613.21.094.083 7 7c.029.028.055.059.08.09l-.08-.09a1.008 1.008 0 0 1 .292.675L16 8v.033l-.004.052L16 8a1.008 1.008 0 0 1-.22.625l-.073.082-7 7a1 1 0 0 1-1.497-1.32l.083-.094L12.585 9H1a1 1 0 0 1-.117-1.993L1 7h11.585L7.293 1.707A1 1 0 0 1 7.21.387l.083-.094A1 1 0 0 1 8.613.21Z"/></svg></span></span></a></div></div></div><li><div class="ch-nav-v2-item "><a href=https://clickhouse.com/docs class="ch-nav-v2-link    undefined "><span>Documentation</span></a></div><li><div class="ch-nav-v2-item "><a href="" class="ch-nav-v2-link  has-children  undefined "><span>Resources</span><span class=chevron><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron right mobile-chevron "><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron down desktop-chevron "><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg></span></a><div class="ch-nav-v2-item__children "><div class=""><ul class="ch-nav-v2-sub-nav-resources ch-nav-v2-list"><li><a href=https://clickhouse.com/user-stories class="ch-nav-v2-link  ">User stories</a><li><a href=https://clickhouse.com/blog class="ch-nav-v2-link  ">Blog</a><li><a href=https://clickhouse.com/company/events class="ch-nav-v2-link  ">Events</a><li><a href=https://clickhouse.com/learn class="ch-nav-v2-link  ">Learning and certification</a><li><a href="" class="ch-nav-v2-link w-full items-center justify-between  "><span>Comparison</span><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 fill=none viewBox="0 0 6 10" class="ch-nav-v2-chevron right text-neutral-500"><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="m1 9 4-4-4-4"/></svg></a><ul class="ch-nav-v2-sub-nav ch-nav-v2-list "><li><a href=https://clickhouse.com/comparison/bigquery class="ch-nav-v2-link block w-full ">BigQuery</a><li><a href=https://clickhouse.com/comparison/postgresql class="ch-nav-v2-link block w-full ">PostgreSQL</a><li><a href=https://clickhouse.com/comparison/redshift class="ch-nav-v2-link block w-full ">Redshift</a><li><a href=https://clickhouse.com/comparison/rockset class="ch-nav-v2-link block w-full ">Rockset</a><li><a href=https://clickhouse.com/comparison/snowflake class="ch-nav-v2-link block w-full ">Snowflake</a></ul><li><a href=https://clickhouse.com/videos class="ch-nav-v2-link block w-full ">Video</a><li><a href=https://clickhouse.com/demos class="ch-nav-v2-link block w-full ">Demo</a></ul></div></div></div><li><div class="ch-nav-v2-item "><a href=/pricing class="ch-nav-v2-link    undefined "><span>Pricing</span></a></div><li><div class="ch-nav-v2-item "><a href="/company/contact?loc=nav" class="ch-nav-v2-link    undefined "><span>Contact</span></a></div></ul></div></nav><div class=navRight_Xotf><a href="https://github.com/ClickHouse/ClickHouse?utm_source=clickhouse&utm_medium=website&utm_campaign=website-nav" target=_blank class=githubStars_xKU0><div class=githubStarsContainer_fzg6><svg width=16 height=16 viewBox="0 0 16 16" fill=none xmlns=http://www.w3.org/2000/svg><path fill-rule=evenodd clip-rule=evenodd d="M8 1.75C4.27062 1.75 1.25 4.77062 1.25 8.5C1.25 11.4869 3.18219 14.0097 5.86531 14.9041C6.20281 14.9631 6.32937 14.7606 6.32937 14.5834C6.32937 14.4231 6.32094 13.8916 6.32094 13.3263C4.625 13.6384 4.18625 12.9128 4.05125 12.5331C3.97531 12.3391 3.64625 11.74 3.35938 11.5797C3.12312 11.4531 2.78562 11.1409 3.35094 11.1325C3.8825 11.1241 4.26219 11.6219 4.38875 11.8244C4.99625 12.8453 5.96656 12.5584 6.35469 12.3813C6.41375 11.9425 6.59094 11.6472 6.785 11.4784C5.28312 11.3097 3.71375 10.7275 3.71375 8.14563C3.71375 7.41156 3.97531 6.80406 4.40563 6.33156C4.33812 6.16281 4.10187 5.47094 4.47312 4.54281C4.47312 4.54281 5.03844 4.36563 6.32937 5.23469C6.86937 5.08281 7.44313 5.00687 8.01688 5.00687C8.59063 5.00687 9.16438 5.08281 9.70438 5.23469C10.9953 4.35719 11.5606 4.54281 11.5606 4.54281C11.9319 5.47094 11.6956 6.16281 11.6281 6.33156C12.0584 6.80406 12.32 7.40312 12.32 8.14563C12.32 10.7359 10.7422 11.3097 9.24031 11.4784C9.485 11.6894 9.69594 12.0944 9.69594 12.7272C9.69594 13.63 9.6875 14.3556 9.6875 14.5834C9.6875 14.7606 9.81406 14.9716 10.1516 14.9041C12.8178 14.0097 14.75 11.4784 14.75 8.5C14.75 4.77062 11.7294 1.75 8 1.75Z" fill=currentColor /></svg><span class=githubText_pqqB>46.0k</span></div></a><div class=mobileSearchBar_lGd9><a href=/docs/search class="DocSearch DocSearch-Button" aria-label=Search><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys><kbd class=DocSearch-Button-Key>Ctrl</kbd><kbd class=DocSearch-Button-Key>K</kbd></span></a></div><div class=signUp_pDjn><a href="https://console.clickhouse.cloud/signIn?loc=docs-nav-signIn-cta" class="sign-in navbar__link ch-menu signIn_n8kr">Sign in</a><a href="https://console.clickhouse.cloud/signUp?loc=docs-nav-signUp-cta" class=click-button-anchor><button class="click-button primary-btn">Get started</button></a></div><svg class=docsNavBurger_SkeB width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></div></div><div class="secondary-nav--items secondaryMenu_SZAs"><div class=dropdownCategoriesContainer_DwBX><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/introduction-clickhouse>Get started</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/cloud/overview>Cloud</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/updating-data>Manage data</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 docsNavSelected_x6p7" href=/docs/guides/manage-and-deploy-index>Server admin</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/sql-reference>Reference</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/integrations>Integrations</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/use-cases/observability/clickstack/overview>ClickStack</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/chdb>chDB</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class="docsNavDropdownContainer_cADf hasDropdown_sqVj"><span class=docsNavDropdownToolbarLink_WLn0><a class="docsNavDropdownToolbarTopLevelLink_lJY0 " href=/docs/about>About</a> <span style=margin-left:8px><svg xmlns=http://www.w3.org/2000/svg width=6 height=10 viewBox="0 0 6 10" style=width:6px;height:10px;fill:none;color:#6B7280;transform:rotate(90deg)><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M1 9L5 5 1 1"/></svg></span></span></div><div class=docsNavDropdownContainer_cADf><a class=docsNavDropdownToolbarTopLevelLink_lJY0 href=/docs/knowledgebase><span>Knowledge Base</span></a></div></div><div class="secondaryMenuRight_dXHH secondary-nav--items-right"><div class="navbar__item dropdown dropdown--hoverable"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_DSK9><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>English</a><ul class=dropdown__menu><li><a href=/docs/guides/sre/keeper/clickhouse-keeper target=_self rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=en>English</a><li><a href=/docs/jp/guides/sre/keeper/clickhouse-keeper target=_self rel="noopener noreferrer" class=dropdown__link lang=jp>日本語</a><li><a href=/docs/zh/guides/sre/keeper/clickhouse-keeper target=_self rel="noopener noreferrer" class=dropdown__link lang=zh>中文</a><li><a href=/docs/ru/guides/sre/keeper/clickhouse-keeper target=_self rel="noopener noreferrer" class=dropdown__link lang=ru>Русский</a></ul></div><button class="colorModeButton_EOjh navbar-color-toggle"><svg xmlns=http://www.w3.org/2000/svg fill=none width=31 height=31 viewBox="0 0 24 24" stroke-width=1.5 stroke=currentColor class="w-6 h-6" stroke-linecap=round stroke-linejoin=round><path stroke-linecap=round stroke-linejoin=round d="M18.3945 13.0269C18.7245 12.8719 19.0765 13.1969 18.9845 13.5499C18.6705 14.7519 18.0535 15.8959 17.1035 16.8459C14.2825 19.6669 9.76953 19.7259 7.02153 16.9779C4.27353 14.2299 4.33353 9.71589 7.15453 6.89489C8.10453 5.94489 9.24753 5.32789 10.4505 5.01389C10.8035 4.92189 11.1275 5.27389 10.9735 5.60389C9.97153 7.74289 10.3005 10.3049 11.9975 12.0019C13.6935 13.6999 16.2555 14.0289 18.3945 13.0269V13.0269Z"/></svg></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0 docsWrapper_bSxm"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docPage_F0g8><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_ktZT><div class=sidebarSearchContainer_qwgL><a href=/docs/search class="DocSearch DocSearch-Button" aria-label=Search><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys><kbd class=DocSearch-Button-Key>Ctrl</kbd><kbd class=DocSearch-Button-Key>K</kbd></span></a></div><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qCLW" style=padding-top:1.75rem;margin-bottom:3.5rem;overflow-y:auto><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link=true><a class="menu__link menu__link--active" href=/docs/guides/manage-and-deploy-index>Manage and deploy</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link=true><a class="menu__link menu__link--sublist" aria-expanded=false tabindex=0 href=/docs/deployment-guides/index>Deployment and scaling</a><button aria-label="Toggle the collapsible sidebar category 'Deployment and scaling'" type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link=true><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded=false tabindex=0 href=/docs/clickhouse-operator/overview>ClickHouse Operator</a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/guides/separation-storage-compute>Separation of storage and compute</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/docs/guides/sre/keeper/clickhouse-keeper>Configuring ClickHouse Keeper</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/guides/sre/network-ports>Network ports</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/guides/sre/scaling-clusters>Rebalancing shards</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/faq/operations/multi-region-replication>Does ClickHouse support multi-region replication?</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/faq/operations/production>Which ClickHouse version to use in production?</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/cluster-discovery>Cluster discovery</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/monitoring>Monitoring</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/opentelemetry>Tracing ClickHouse with OpenTelemetry</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/quotas>Quotas</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/ssl-zookeeper>Secured Communication with Zookeeper</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/startup-scripts>Startup scripts</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/storing-data>External disks for storing data</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/allocation-profiling>Allocation profiling</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link=true><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded=false tabindex=0 href=/docs/operations/backup/overview>Backup/Restore</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link=true><a class="menu__link menu__link--sublist" aria-expanded=false tabindex=0 href=/docs/operations/allocation-profiling>Allocation profiling</a><button aria-label="Toggle the collapsible sidebar category 'Allocation profiling'" type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/caches>Caches</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/workload-scheduling>Workload scheduling</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/update>Self-managed Upgrade</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/guides/troubleshooting>Troubleshooting</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/tips>OSS usage recommendations</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/sql-reference/distributed-ddl>Distributed DDL</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link=true><a class=menu__link href=/docs/operations/settings>Settings</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/overview>Settings Overview</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/server-configuration-parameters/settings>Server Settings</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/settings>Session Settings</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/merge-tree-settings>MergeTree tables settings</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/formats>Format Settings</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/composable-protocols>Composable protocols</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/constraints-on-settings>Constraints on settings</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/memory-overcommit>Memory overcommit</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/permissions-for-queries>Permissions for queries</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/query-complexity>Restrictions on query complexity</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/server-overload>Server overload</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/query-level>Query-level Session Settings</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/settings-profiles>Settings profiles</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/settings-users>User Settings</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/named-collections>Named collections</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/configuration-files>Configuration Files</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/settings/tcp-connection-limits>TCP connection limits</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link=true><a class="menu__link menu__link--sublist" aria-expanded=false href=/docs/operations/system-tables>System tables</a><button aria-label="Toggle the collapsible sidebar category 'System tables'" type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link=true><a class=menu__link href=/docs/security-and-authentication>Security and authentication</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link=true><a class="menu__link menu__link--sublist" aria-expanded=false tabindex=0 href=/docs/guides/sre/tls>TLS</a><button aria-label="Toggle the collapsible sidebar category 'TLS'" type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/access-rights>Users and roles</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link=true><a class="menu__link menu__link--sublist" aria-expanded=false tabindex=0 href=/docs/operations/external-authenticators>External authenticators</a><button aria-label="Toggle the collapsible sidebar category 'External authenticators'" type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link=true><a class=menu__link href=/docs/operations/utilities>Tools and utilities</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/utilities/backupview>clickhouse_backupview</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/utilities/clickhouse-benchmark>clickhouse-benchmark</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/utilities/clickhouse-compressor>clickhouse-compressor</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/utilities/clickhouse-disks>clickhouse-disks</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/utilities/clickhouse-format>clickhouse-format</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/utilities/clickhouse-keeper-client>clickhouse-keeper-client</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/utilities/clickhouse-local>clickhouse-local</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/utilities/clickhouse-obfuscator>clickhouse-obfuscator</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/utilities/odbc-bridge>clickhouse-odbc-bridge</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/operations/utilities/static-files-disk-uploader>clickhouse-static-files-disk-uploader</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/getting-started/playground>ClickHouse playground</a></ul></ul></nav></div></div></aside><main class=docMainContainer_Vlkt><div class="container padding-bottom--lg main-content-wrapper docItemWrapper_GJ0o"><div class=row style=flex-wrap:nowrap><div class="col docItemCol_PW1h"><div class=docItemContainer_F8S3><article><div class=docHeaderContainer_yf04><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="Breadcrumb navigation"><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/docs/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_xK9p><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/docs/guides/manage-and-deploy-index><span itemprop=name>Manage and deploy</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Configuring ClickHouse Keeper</span><meta itemprop=position content=2></ul></nav><a href=https://github.com/ClickHouse/clickhouse-docs/blob/main/docs/guides/sre/keeper/index.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="theme-doc-markdown markdown"><header><h1>ClickHouse Keeper (clickhouse-keeper)</h1></header>
<!-- -->
<div class=cloudNotSupportedBadge_FcNk><div class=cloudNotSupportedIcon_DxHk style=margin-right:8px;margin-top:4px><svg width=16 height=16 viewBox="0 0 16 16" fill=none xmlns=http://www.w3.org/2000/svg><path stroke-width=1.5 d="M6.33366 12.6666L12.3739 12.6667C13.6593 12.6667 14.7073 11.6187 14.7073 10.3334C14.7073 9.04804 13.6593 8.00003 12.3739 8.00003C12.3739 8.00003 12.3337 7.66659 12.0003 7.33325M10.667 5.33322C8.00033 2.33325 4.45395 4.78537 4.14195 6.68203C2.55728 6.7627 1.29395 8.06203 1.29395 9.6667C1.29395 11.3234 2.66699 12.6666 4.00033 12.6666" stroke=#660099 stroke-linecap=round stroke-linejoin=round /><path stroke-width=1.5 d="M2.66699 14L12.0003 4.66663" stroke=#660099 stroke-linecap=round stroke-linejoin=round /></svg></div>Not supported in ClickHouse Cloud</div>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>Note</div><p>This page isn't applicable to <a href=https://clickhouse.com/cloud target=_blank rel="noopener noreferrer">ClickHouse Cloud</a>. The procedure documented here is automated in ClickHouse Cloud services.</div></div>
<p>ClickHouse Keeper provides the coordination system for data <a href=/docs/engines/table-engines/mergetree-family/replication>replication</a> and <a href=/docs/sql-reference/distributed-ddl>distributed DDL</a> queries execution. ClickHouse Keeper is compatible with ZooKeeper.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=implementation-details>Implementation details<a href=#implementation-details class=hash-link aria-label="Direct link to Implementation details" title="Direct link to Implementation details">​</a></h3>
<p>ZooKeeper is one of the first well-known open-source coordination systems. It's implemented in Java, and has quite a simple and powerful data model. ZooKeeper's coordination algorithm, ZooKeeper Atomic Broadcast (ZAB), doesn't provide linearizability guarantees for reads, because each ZooKeeper node serves reads locally. Unlike ZooKeeper, ClickHouse Keeper is written in C++ and uses the <a href=https://raft.github.io/ target=_blank rel="noopener noreferrer">RAFT algorithm</a> <a href=https://github.com/eBay/NuRaft target=_blank rel="noopener noreferrer">implementation</a>. This algorithm allows linearizability for reads and writes, and has several open-source implementations in different languages.</p>
<p>By default, ClickHouse Keeper provides the same guarantees as ZooKeeper: linearizable writes and non-linearizable reads. It has a compatible client-server protocol, so any standard ZooKeeper client can be used to interact with ClickHouse Keeper. Snapshots and logs have an incompatible format with ZooKeeper, but the <code>clickhouse-keeper-converter</code> tool enables the conversion of ZooKeeper data to ClickHouse Keeper snapshots. The interserver protocol in ClickHouse Keeper is also incompatible with ZooKeeper so a mixed ZooKeeper / ClickHouse Keeper cluster is impossible.</p>
<p>ClickHouse Keeper supports Access Control Lists (ACLs) the same way as <a href=https://zookeeper.apache.org/doc/r3.1.2/zookeeperProgrammers.html#sc_ZooKeeperAccessControl target=_blank rel="noopener noreferrer">ZooKeeper</a> does. ClickHouse Keeper supports the same set of permissions and has the identical built-in schemes: <code>world</code>, <code>auth</code> and <code>digest</code>. The digest authentication scheme uses the pair <code>username:password</code>, the password is encoded in Base64.</p>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>Note</div><p>External integrations aren't supported.</div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=configuration>Configuration<a href=#configuration class=hash-link aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h3>
<p>ClickHouse Keeper can be used as a standalone replacement for ZooKeeper or as an internal part of the ClickHouse server. In both cases the configuration is almost the same <code>.xml</code> file.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=keeper-configuration-settings>Keeper configuration settings<a href=#keeper-configuration-settings class=hash-link aria-label="Direct link to Keeper configuration settings" title="Direct link to Keeper configuration settings">​</a></h4>
<p>The main ClickHouse Keeper configuration tag is <code>&lt;keeper_server></code> and has the following parameters:</p>
<table><thead><tr><th>Parameter<th>Description<th>Default<tbody><tr><td><code>tcp_port</code><td>Port for a client to connect.<td><code>2181</code><tr><td><code>tcp_port_secure</code><td>Secure port for an SSL connection between client and keeper-server.<td>-<tr><td><code>server_id</code><td>Unique server id, each participant of the ClickHouse Keeper cluster must have a unique number (1, 2, 3, and so on).<td>-<tr><td><code>log_storage_path</code><td>Path to coordination logs, just like ZooKeeper it is best to store logs on non-busy nodes.<td>-<tr><td><code>snapshot_storage_path</code><td>Path to coordination snapshots.<td>-<tr><td><code>enable_reconfiguration</code><td>Enable dynamic cluster reconfiguration via <a href=#reconfiguration><code>reconfig</code></a>.<td><code>False</code><tr><td><code>max_memory_usage_soft_limit</code><td>Soft limit in bytes of keeper max memory usage.<td><code>max_memory_usage_soft_limit_ratio</code> * <code>physical_memory_amount</code><tr><td><code>max_memory_usage_soft_limit_ratio</code><td>If <code>max_memory_usage_soft_limit</code> isn't set or set to zero, we use this value to define the default soft limit.<td><code>0.9</code><tr><td><code>cgroups_memory_observer_wait_time</code><td>If <code>max_memory_usage_soft_limit</code> isn't set or is set to <code>0</code>, we use this interval to observe the amount of physical memory. Once the memory amount changes, we will recalculate Keeper's memory soft limit by <code>max_memory_usage_soft_limit_ratio</code>.<td><code>15</code><tr><td><code>http_control</code><td>Configuration of <a href=#http-control>HTTP control</a> interface.<td>-<tr><td><code>digest_enabled</code><td>Enable real-time data consistency check<td><code>True</code><tr><td><code>create_snapshot_on_exit</code><td>Create a snapshot during shutdown<td>-<tr><td><code>hostname_checks_enabled</code><td>Enable sanity hostname checks for cluster configuration (e.g. if localhost is used with remote endpoints)<td><code>True</code><tr><td><code>four_letter_word_white_list</code><td>White list of 4lw commands.<td><code>conf, cons, crst, envi, ruok, srst, srvr, stat, wchs, dirs, mntr, isro, rcvr, apiv, csnp, lgif, rqld, ydld</code><tr><td><code>enable_ipv6</code><td>Enable IPv6<td><code>True</code></table>
<p>Other common parameters are inherited from the ClickHouse server config (<code>listen_host</code>, <code>logger</code>, and so on).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=internal-coordination-settings>Internal coordination settings<a href=#internal-coordination-settings class=hash-link aria-label="Direct link to Internal coordination settings" title="Direct link to Internal coordination settings">​</a></h4>
<p>Internal coordination settings are located in the <code>&lt;keeper_server>.&lt;coordination_settings></code> section and have the following parameters:</p>
<table><thead><tr><th>Parameter<th>Description<th>Default<tbody><tr><td><code>operation_timeout_ms</code><td>Timeout for a single client operation (ms)<td><code>10000</code><tr><td><code>min_session_timeout_ms</code><td>Min timeout for client session (ms)<td><code>10000</code><tr><td><code>session_timeout_ms</code><td>Max timeout for client session (ms)<td><code>100000</code><tr><td><code>dead_session_check_period_ms</code><td>How often ClickHouse Keeper checks for dead sessions and removes them (ms)<td><code>500</code><tr><td><code>heart_beat_interval_ms</code><td>How often a ClickHouse Keeper leader will send heartbeats to followers (ms)<td><code>500</code><tr><td><code>election_timeout_lower_bound_ms</code><td>If the follower doesn't receive a heartbeat from the leader in this interval, then it can initiate leader election. Must be less than or equal to  <code>election_timeout_upper_bound_ms</code>. Ideally they shouldn't be equal.<td><code>1000</code><tr><td><code>election_timeout_upper_bound_ms</code><td>If the follower doesn't receive a heartbeat from the leader in this interval, then it must initiate leader election.<td><code>2000</code><tr><td><code>rotate_log_storage_interval</code><td>How many log records to store in a single file.<td><code>100000</code><tr><td><code>reserved_log_items</code><td>How many coordination log records to store before compaction.<td><code>100000</code><tr><td><code>snapshot_distance</code><td>How often ClickHouse Keeper will create new snapshots (in the number of records in logs).<td><code>100000</code><tr><td><code>snapshots_to_keep</code><td>How many snapshots to keep.<td><code>3</code><tr><td><code>stale_log_gap</code><td>Threshold when leader considers follower as stale and sends the snapshot to it instead of logs.<td><code>10000</code><tr><td><code>fresh_log_gap</code><td>When node became fresh.<td><code>200</code><tr><td><code>max_requests_batch_size</code><td>Max size of batch in requests count before it will be sent to RAFT.<td><code>100</code><tr><td><code>force_sync</code><td>Call <code>fsync</code> on each write to coordination log.<td><code>true</code><tr><td><code>quorum_reads</code><td>Execute read requests as writes through whole RAFT consensus with similar speed.<td><code>false</code><tr><td><code>raft_logs_level</code><td>Text logging level about coordination (trace, debug, and so on).<td><code>system default</code><tr><td><code>auto_forwarding</code><td>Allow to forward write requests from followers to the leader.<td><code>true</code><tr><td><code>shutdown_timeout</code><td>Wait to finish internal connections and shutdown (ms).<td><code>5000</code><tr><td><code>startup_timeout</code><td>If the server doesn't connect to other quorum participants in the specified timeout it will terminate (ms).<td><code>30000</code><tr><td><code>async_replication</code><td>Enable async replication. All write and read guarantees are preserved while better performance is achieved. Settings is disabled by default to not break backwards compatibility<td><code>false</code><tr><td><code>latest_logs_cache_size_threshold</code><td>Maximum total size of in-memory cache of latest log entries<td><code>1GiB</code><tr><td><code>commit_logs_cache_size_threshold</code><td>Maximum total size of in-memory cache of log entries needed next for commit<td><code>500MiB</code><tr><td><code>disk_move_retries_wait_ms</code><td>How long to wait between retries after a failure which happened while a file was being moved between disks<td><code>1000</code><tr><td><code>disk_move_retries_during_init</code><td>The amount of retries after a failure which happened while a file was being moved between disks during initialization<td><code>100</code><tr><td><code>experimental_use_rocksdb</code><td>Use rocksdb as backend storage<td><code>0</code></table>
<p>Quorum configuration is located in the <code>&lt;keeper_server>.&lt;raft_configuration></code> section and contain servers description.</p>
<p>The only parameter for the whole quorum is <code>secure</code>, which enables encrypted connection for communication between quorum participants. The parameter can be set <code>true</code> if SSL connection is required for internal communication between nodes, or left unspecified otherwise.</p>
<p>The main parameters for each <code>&lt;server></code> are:</p>
<ul class=custom-ul>
<li class=custom-li><code>id</code> — Server identifier in a quorum.</li>
<li class=custom-li><code>hostname</code> — Hostname where this server is placed.</li>
<li class=custom-li><code>port</code> — Port where this server listens for connections.</li>
<li class=custom-li><code>can_become_leader</code> — Set to <code>false</code> to set up the server as a <code>learner</code>. If omitted, the value is <code>true</code>.</li>
</ul>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>Note</div><p>In the case of a change in the topology of your ClickHouse Keeper cluster (e.g., replacing a server), please make sure to keep the mapping of <code>server_id</code> to <code>hostname</code> consistent and avoid shuffling or reusing an existing <code>server_id</code> for different servers (e.g., it can happen if your rely on automation scripts to deploy ClickHouse Keeper)<p>If the host of a Keeper instance can change, we recommend to define and use a hostname instead of raw IP addresses. Changing hostname is equal to removing and adding the server back which in some cases can be impossible to do (e.g. not enough Keeper instances for quorum).</div></div>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>Note</div><p><code>async_replication</code> is disabled by default to avoid breaking backwards compatibility. If you have all your Keeper instances in a cluster running a version supporting <code>async_replication</code> (v23.9+), we recommend enabling it because it can improve performance without any downsides.</div></div>
<p>Examples of configuration for quorum with three nodes can be found in <a href=https://github.com/ClickHouse/ClickHouse/tree/master/tests/integration target=_blank rel="noopener noreferrer">integration tests</a> with <code>test_keeper_</code> prefix. Example configuration for server #1:</p>
<div class=wrapper_EBtA style=height:565.5px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>&lt;keeper_server>
    &lt;tcp_port>2181&lt;/tcp_port>
    &lt;server_id>1&lt;/server_id>
    &lt;log_storage_path>/var/lib/clickhouse/coordination/log&lt;/log_storage_path>
    &lt;snapshot_storage_path>/var/lib/clickhouse/coordination/snapshots&lt;/snapshot_storage_path>

    &lt;coordination_settings>
        &lt;operation_timeout_ms>10000&lt;/operation_timeout_ms>
        &lt;session_timeout_ms>30000&lt;/session_timeout_ms>
        &lt;raft_logs_level>trace&lt;/raft_logs_level>
    &lt;/coordination_settings>

    &lt;raft_configuration>
        &lt;server>
            &lt;id>1&lt;/id>
            &lt;hostname>zoo1&lt;/hostname>
            &lt;port>9234&lt;/port>
        &lt;/server>
        &lt;server>
            &lt;id>2&lt;/id>
            &lt;hostname>zoo2&lt;/hostname>
            &lt;port>9234&lt;/port>
        &lt;/server>
        &lt;server>
            &lt;id>3&lt;/id>
            &lt;hostname>zoo3&lt;/hostname>
            &lt;port>9234&lt;/port>
        &lt;/server>
    &lt;/raft_configuration>
&lt;/keeper_server>
</code></pre></div><div class=activity_PoTP></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=how-to-run>How to run<a href=#how-to-run class=hash-link aria-label="Direct link to How to run" title="Direct link to How to run">​</a></h3>
<p>ClickHouse Keeper is bundled into the ClickHouse server package, just add configuration of <code>&lt;keeper_server></code> to your <code>/etc/your_path_to_config/clickhouse-server/config.xml</code> and start ClickHouse server as always. If you want to run standalone ClickHouse Keeper you can start it in a similar way with:</p>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-bash><code class=language-bash>clickhouse-keeper --config /etc/your_path_to_config/config.xml
</code></pre></div><div class=activity_PoTP></div></div>
<p>If you don't have the symlink (<code>clickhouse-keeper</code>) you can create it or specify <code>keeper</code> as an argument to <code>clickhouse</code>:</p>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-bash><code class=language-bash>clickhouse keeper --config /etc/your_path_to_config/config.xml
</code></pre></div><div class=activity_PoTP></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=four-letter-word-commands>Four letter word commands<a href=#four-letter-word-commands class=hash-link aria-label="Direct link to Four letter word commands" title="Direct link to Four letter word commands">​</a></h3>
<p>ClickHouse Keeper also provides 4lw commands which are almost the same with Zookeeper. Each command is composed of four letters such as <code>mntr</code>, <code>stat</code> etc. There are some more interesting commands: <code>stat</code> gives some general information about the server and connected clients, while <code>srvr</code> and <code>cons</code> give extended details on server and connections respectively.</p>
<p>The 4lw commands has a white list configuration <code>four_letter_word_white_list</code> which has default value <code>conf,cons,crst,envi,ruok,srst,srvr,stat,wchs,dirs,mntr,isro,rcvr,apiv,csnp,lgif,rqld,ydld</code>.</p>
<p>You can issue the commands to ClickHouse Keeper via telnet or nc, at the client port.</p>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-bash><code class=language-bash>echo mntr | nc localhost 9181
</code></pre></div><div class=activity_PoTP></div></div>
<p>Bellow is the detailed 4lw commands:</p>
<ul class=custom-ul>
<li class=custom-li><code>ruok</code>: Tests if server is running in a non-error state. The server will respond with <code>imok</code> if it is running. Otherwise, it won't respond at all. A response of <code>imok</code> doesn't necessarily indicate that the server has joined the quorum, just that the server process is active and bound to the specified client port. Use "stat" for details on state with respect to quorum and client connection information.</li>
</ul>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>imok
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>mntr</code>: Outputs a list of variables that could be used for monitoring the health of the cluster.</li>
</ul>
<div class=wrapper_EBtA style=height:320.45000000000005px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>zk_version      v21.11.1.1-prestable-7a4a0b0edef0ad6e0aa662cd3b90c3f4acf796e7
zk_avg_latency  0
zk_max_latency  0
zk_min_latency  0
zk_packets_received     68
zk_packets_sent 68
zk_num_alive_connections        1
zk_outstanding_requests 0
zk_server_state leader
zk_znode_count  4
zk_watch_count  1
zk_ephemerals_count     0
zk_approximate_data_size        723
zk_open_file_descriptor_count   310
zk_max_file_descriptor_count    10240
zk_followers    0
zk_synced_followers     0
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>srvr</code>: Lists full details for the server.</li>
</ul>
<div class=wrapper_EBtA style=height:169.65px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>ClickHouse Keeper version: v21.11.1.1-prestable-7a4a0b0edef0ad6e0aa662cd3b90c3f4acf796e7
Latency min/avg/max: 0/0/0
Received: 2
Sent : 2
Connections: 1
Outstanding: 0
Zxid: 34
Mode: leader
Node count: 4
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>stat</code>: Lists brief details for the server and connected clients.</li>
</ul>
<div class=wrapper_EBtA style=height:226.20000000000002px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>ClickHouse Keeper version: v21.11.1.1-prestable-7a4a0b0edef0ad6e0aa662cd3b90c3f4acf796e7
Clients:
 192.168.1.1:52852(recved=0,sent=0)
 192.168.1.1:52042(recved=24,sent=48)
Latency min/avg/max: 0/0/0
Received: 4
Sent : 4
Connections: 1
Outstanding: 0
Zxid: 36
Mode: leader
Node count: 4
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>srst</code>: Reset server statistics. The command will affect the result of <code>srvr</code>, <code>mntr</code> and <code>stat</code>.</li>
</ul>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>Server stats reset.
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>conf</code>: Print details about serving configuration.</li>
</ul>
<div class=wrapper_EBtA style=height:527.8000000000001px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>server_id=1
tcp_port=2181
four_letter_word_white_list=*
log_storage_path=./coordination/logs
snapshot_storage_path=./coordination/snapshots
max_requests_batch_size=100
session_timeout_ms=30000
operation_timeout_ms=10000
dead_session_check_period_ms=500
heart_beat_interval_ms=500
election_timeout_lower_bound_ms=1000
election_timeout_upper_bound_ms=2000
reserved_log_items=1000000000000000
snapshot_distance=10000
auto_forwarding=true
shutdown_timeout=5000
startup_timeout=240000
raft_logs_level=information
snapshots_to_keep=3
rotate_log_storage_interval=100000
stale_log_gap=10000
fresh_log_gap=200
max_requests_batch_size=100
quorum_reads=false
force_sync=false
compress_logs=true
compress_snapshots_with_zstd_format=true
configuration_change_tries_count=20
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>cons</code>: List full connection/session details for all clients connected to this server. Includes information on numbers of packets received/sent, session id, operation latencies, last operation performed, etc...</li>
</ul>
<div class=wrapper_EBtA style=height:37.7px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response> 192.168.1.1:52163(recved=0,sent=0,sid=0xffffffffffffffff,lop=NA,est=1636454787393,to=30000,lzxid=0xffffffffffffffff,lresp=0,llat=0,minlat=0,avglat=0,maxlat=0)
 192.168.1.1:52042(recved=9,sent=18,sid=0x0000000000000001,lop=List,est=1636454739887,to=30000,lcxid=0x0000000000000005,lzxid=0x0000000000000005,lresp=1636454739892,llat=0,minlat=0,avglat=0,maxlat=0)
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>crst</code>: Reset connection/session statistics for all connections.</li>
</ul>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>Connection stats reset.
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>envi</code>: Print details about serving environment</li>
</ul>
<div class=wrapper_EBtA style=height:207.35000000000002px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>Environment:
clickhouse.keeper.version=v21.11.1.1-prestable-7a4a0b0edef0ad6e0aa662cd3b90c3f4acf796e7
host.name=ZBMAC-C02D4054M.local
os.name=Darwin
os.arch=x86_64
os.version=19.6.0
cpu.count=12
user.name=root
user.home=/Users/JackyWoo/
user.dir=/Users/JackyWoo/project/jd/clickhouse/cmake-build-debug/programs/
user.tmp=/var/folders/b4/smbq5mfj7578f2jzwn602tt40000gn/T/
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>dirs</code>: Shows the total size of snapshot and log files in bytes</li>
</ul>
<div class=wrapper_EBtA style=height:37.7px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>snapshot_dir_size: 0
log_dir_size: 3875
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>isro</code>: Tests if server is running in read-only mode. The server will respond with <code>ro</code> if in read-only mode or <code>rw</code> if not in read-only mode.</li>
</ul>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>rw
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>wchs</code>: Lists brief information on watches for the server.</li>
</ul>
<div class=wrapper_EBtA style=height:37.7px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>1 connections watching 1 paths
Total watches:1
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>wchc</code>: Lists detailed information on watches for the server, by session. This outputs a list of sessions (connections) with associated watches (paths). Note, depending on the number of watches this operation may be expensive (impact server performance), use it carefully.</li>
</ul>
<div class=wrapper_EBtA style=height:37.7px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>0x0000000000000001
    /clickhouse/task_queue/ddl
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>wchp</code>: Lists detailed information on watches for the server, by path. This outputs a list of paths (znodes) with associated sessions. Note, depending on the number of watches this operation may be expensive (i.e., impact server performance), use it carefully.</li>
</ul>
<div class=wrapper_EBtA style=height:37.7px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>/clickhouse/task_queue/ddl
    0x0000000000000001
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>dump</code>: Lists the outstanding sessions and ephemeral nodes. This only works on the leader.</li>
</ul>
<div class=wrapper_EBtA style=height:113.10000000000001px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>Sessions dump (2):
0x0000000000000001
0x0000000000000002
Sessions with Ephemerals (1):
0x0000000000000001
 /clickhouse/task_queue/ddl
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>csnp</code>: Schedule a snapshot creation task. Return the last committed log index of the scheduled snapshot if success or <code>Failed to schedule snapshot creation task.</code> if failed. Note that <code>lgif</code> command can help you determine whether the snapshot is done.</li>
</ul>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>100
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>lgif</code>: Keeper log information. <code>first_log_idx</code> : my first log index in log store; <code>first_log_term</code> : my first log term; <code>last_log_idx</code> : my last log index in log store; <code>last_log_term</code> : my last log term; <code>last_committed_log_idx</code> : my last committed log index in state machine; <code>leader_committed_log_idx</code> : leader's committed log index from my perspective; <code>target_committed_log_idx</code> : target log index should be committed to; <code>last_snapshot_idx</code> : the largest committed log index in last snapshot.</li>
</ul>
<div class=wrapper_EBtA style=height:150.8px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>first_log_idx   1
first_log_term  1
last_log_idx    101
last_log_term   1
last_committed_log_idx  100
leader_committed_log_idx    101
target_committed_log_idx    101
last_snapshot_idx   50
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>rqld</code>: Request to become new leader. Return <code>Sent leadership request to leader.</code> if request sent or <code>Failed to send leadership request to leader.</code> if request not sent. Note that if node is already leader the outcome is same as the request is sent.</li>
</ul>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>Sent leadership request to leader.
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>ftfl</code>: Lists all feature flags and whether they're enabled for the Keeper instance.</li>
</ul>
<div class=wrapper_EBtA style=height:56.550000000000004px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>filtered_list   1
multi_read  1
check_not_exists    0
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>ydld</code>: Request to yield leadership and become follower. If the server receiving the request is leader, it will pause write operations first, wait until the successor (current leader can never be successor) finishes the catch-up of the latest log, and then resign. The successor will be chosen automatically. Return <code>Sent yield leadership request to leader.</code> if request sent or <code>Failed to send yield leadership request to leader.</code> if request not sent. Note that if node is already follower the outcome is same as the request is sent.</li>
</ul>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>Sent yield leadership request to leader.
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li><code>pfev</code>: Returns the values for all collected events. For each event it returns event name, event value, and event's description.</li>
</ul>
<div class=wrapper_EBtA style=height:339.3px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>FileOpen        62      Number of files opened.
Seek    4       Number of times the 'lseek' function was called.
ReadBufferFromFileDescriptorRead        126     Number of reads (read/pread) from a file descriptor. Does not include sockets.
ReadBufferFromFileDescriptorReadFailed  0       Number of times the read (read/pread) from a file descriptor have failed.
ReadBufferFromFileDescriptorReadBytes   178846  Number of bytes read from file descriptors. If the file is compressed, this will show the compressed data size.
WriteBufferFromFileDescriptorWrite      7       Number of writes (write/pwrite) to a file descriptor. Does not include sockets.
WriteBufferFromFileDescriptorWriteFailed        0       Number of times the write (write/pwrite) to a file descriptor have failed.
WriteBufferFromFileDescriptorWriteBytes 153     Number of bytes written to file descriptors. If the file is compressed, this will show compressed data size.
FileSync        2       Number of times the F_FULLFSYNC/fsync/fdatasync function was called for files.
DirectorySync   0       Number of times the F_FULLFSYNC/fsync/fdatasync function was called for directories.
FileSyncElapsedMicroseconds     12756   Total time spent waiting for F_FULLFSYNC/fsync/fdatasync syscall for files.
DirectorySyncElapsedMicroseconds        0       Total time spent waiting for F_FULLFSYNC/fsync/fdatasync syscall for directories.
ReadCompressedBytes     0       Number of bytes (the number of bytes before decompression) read from compressed sources (files, network).
CompressedReadBufferBlocks      0       Number of compressed blocks (the blocks of data that are compressed independent of each other) read from compressed sources (files, network).
CompressedReadBufferBytes       0       Number of uncompressed bytes (the number of bytes after decompression) read from compressed sources (files, network).
AIOWrite        0       Number of writes with Linux or FreeBSD AIO interface
AIOWriteBytes   0       Number of bytes written with Linux or FreeBSD AIO interface
...
</code></pre></div><div class=activity_PoTP></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=http-control>HTTP control<a href=#http-control class=hash-link aria-label="Direct link to HTTP control" title="Direct link to HTTP control">​</a></h3>
<p>ClickHouse Keeper provides an HTTP interface to check if a replica is ready to receive traffic. It may be used in cloud environments, such as <a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#define-readiness-probes target=_blank rel="noopener noreferrer">Kubernetes</a>.</p>
<p>Example of configuration that enables <code>/ready</code> endpoint:</p>
<div class=wrapper_EBtA style=height:188.5px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>&lt;clickhouse>
    &lt;keeper_server>
        &lt;http_control>
            &lt;port>9182&lt;/port>
            &lt;readiness>
                &lt;endpoint>/ready&lt;/endpoint>
            &lt;/readiness>
        &lt;/http_control>
    &lt;/keeper_server>
&lt;/clickhouse>
</code></pre></div><div class=activity_PoTP></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=feature-flags>Feature flags<a href=#feature-flags class=hash-link aria-label="Direct link to Feature flags" title="Direct link to Feature flags">​</a></h3>
<p>Keeper is fully compatible with ZooKeeper and its clients, but it also introduces some unique features and request types that can be used by ClickHouse client.
Because those features can introduce backward incompatible change, most of them are disabled by default and can be enabled using <code>keeper_server.feature_flags</code> config.
All features can be disabled explicitly.
If you want to enable a new feature for your Keeper cluster, we recommend you to first update all the Keeper instances in the cluster to a version that supports the feature and then enable the feature itself.</p>
<p>Example of feature flag config that disables <code>multi_read</code> and enables <code>check_not_exists</code>:</p>
<div class=wrapper_EBtA style=height:150.8px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>&lt;clickhouse>
    &lt;keeper_server>
        &lt;feature_flags>
            &lt;multi_read>0&lt;/multi_read>
            &lt;check_not_exists>1&lt;/check_not_exists>
        &lt;/feature_flags>
    &lt;/keeper_server>
&lt;/clickhouse>
</code></pre></div><div class=activity_PoTP></div></div>
<p>The following features are available:</p>
<table><thead><tr><th>Feature<th>Description<th>Default<tbody><tr><td><code>multi_read</code><td>Support for read multi request<td><code>1</code><tr><td><code>filtered_list</code><td>Support for list request which filters results by the type of node (ephemeral or persistent)<td><code>1</code><tr><td><code>check_not_exists</code><td>Support for <code>CheckNotExists</code> request, which asserts that node doesn't exist<td><code>1</code><tr><td><code>create_if_not_exists</code><td>Support for <code>CreateIfNotExists</code> request, which will try to create a node if it doesn't exist. If it exists, no changes are applied and <code>ZOK</code> is returned<td><code>1</code><tr><td><code>remove_recursive</code><td>Support for <code>RemoveRecursive</code> request, which removes the node along with its subtree<td><code>1</code></table>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>Note</div><p>Some of the feature flags are enabled by default from version 25.7.<br>
<!-- -->The recommended way of upgrading Keeper to 25.7+ is to first upgrade to version 24.9+.</div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=migration-from-zookeeper>Migration from ZooKeeper<a href=#migration-from-zookeeper class=hash-link aria-label="Direct link to Migration from ZooKeeper" title="Direct link to Migration from ZooKeeper">​</a></h3>
<p>Seamless migration from ZooKeeper to ClickHouse Keeper isn't possible. You have to stop your ZooKeeper cluster, convert data, and start ClickHouse Keeper. <code>clickhouse-keeper-converter</code> tool allows converting ZooKeeper logs and snapshots to ClickHouse Keeper snapshot. It works only with ZooKeeper > 3.4. Steps for migration:</p>
<ol class=custom-ol>
<li class=custom-li>
<p>Stop all ZooKeeper nodes.</p>
</li>
<li class=custom-li>
<p>Optional, but recommended: find ZooKeeper leader node, start and stop it again. It will force ZooKeeper to create a consistent snapshot.</p>
</li>
<li class=custom-li>
<p>Run <code>clickhouse-keeper-converter</code> on a leader, for example:</p>
</li>
</ol>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-bash><code class=language-bash>clickhouse-keeper-converter --zookeeper-logs-dir /var/lib/zookeeper/version-2 --zookeeper-snapshots-dir /var/lib/zookeeper/version-2 --output-dir /path/to/clickhouse/keeper/snapshots
</code></pre></div><div class=activity_PoTP></div></div>
<ol class=custom-ol start=4>
<li class=custom-li>Copy snapshot to ClickHouse server nodes with a configured <code>keeper</code> or start ClickHouse Keeper instead of ZooKeeper. The snapshot must persist on all nodes, otherwise, empty nodes can be faster and one of them can become a leader.</li>
</ol>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>Note</div><p><code>keeper-converter</code> tool isn't available from the Keeper standalone binary.
If you have ClickHouse installed, you can use the binary directly:<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-bash><code class=language-bash>clickhouse keeper-converter ...
</code></pre></div><div class=activity_PoTP></div></div><p>Otherwise, you can <a href=/docs/getting-started/quick-start/oss#download-the-binary>download the binary</a> and run the tool as described above without installing ClickHouse.</div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=recovering-after-losing-quorum>Recovering after losing quorum<a href=#recovering-after-losing-quorum class=hash-link aria-label="Direct link to Recovering after losing quorum" title="Direct link to Recovering after losing quorum">​</a></h3>
<p>Because ClickHouse Keeper uses Raft it can tolerate certain amount of node crashes depending on the cluster size. <br>
<!-- -->E.g. for a 3-node cluster, it will continue working correctly if only 1 node crashes.</p>
<p>Cluster configuration can be dynamically configured, but there are some limitations. Reconfiguration relies on Raft also
so to add/remove a node from the cluster you need to have a quorum. If you lose too many nodes in your cluster at the same time without any chance
of starting them again, Raft will stop working and not allow you to reconfigure your cluster using the conventional way.</p>
<p>Nevertheless, ClickHouse Keeper has a recovery mode which allows you to forcefully reconfigure your cluster with only 1 node.
This should be done only as your last resort if you can't start your nodes again, or start a new instance on the same endpoint.</p>
<p>Important things to note before continuing:</p>
<ul class=custom-ul>
<li class=custom-li>Make sure that the failed nodes can't connect to the cluster again.</li>
<li class=custom-li>Don't start any of the new nodes until it's specified in the steps.</li>
</ul>
<p>After making sure that the above things are true, you need to do following:</p>
<ol class=custom-ol>
<li class=custom-li>Pick a single Keeper node to be your new leader. Be aware that the data of that node will be used for the entire cluster, so we recommend using a node with the most up-to-date state.</li>
<li class=custom-li>Before doing anything else, make a backup of the <code>log_storage_path</code> and <code>snapshot_storage_path</code> folders of the picked node.</li>
<li class=custom-li>Reconfigure the cluster on all of the nodes you want to use.</li>
<li class=custom-li>Send the four letter command <code>rcvr</code> to the node you picked which will move the node to the recovery mode OR stop Keeper instance on the picked node and start it again with the <code>--force-recovery</code> argument.</li>
<li class=custom-li>One by one, start Keeper instances on the new nodes making sure that <code>mntr</code> returns <code>follower</code> for the <code>zk_server_state</code> before starting the next one.</li>
<li class=custom-li>While in the recovery mode, the leader node will return error message for <code>mntr</code> command until it achieves quorum with the new nodes and refuse any requests from the client and the followers.</li>
<li class=custom-li>After quorum is achieved, the leader node will return to the normal mode of operation, accepting all the requests using Raft-verify with <code>mntr</code> which should return <code>leader</code> for the <code>zk_server_state</code>.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=using-disks-with-keeper>Using disks with Keeper<a href=#using-disks-with-keeper class=hash-link aria-label="Direct link to Using disks with Keeper" title="Direct link to Using disks with Keeper">​</a></h2>
<p>Keeper supports a subset of <a href=/docs/operations/storing-data>external disks</a> for storing snapshots, log files, and the state file.</p>
<p>Supported types of disks are:</p>
<ul class=custom-ul>
<li class=custom-li>s3_plain</li>
<li class=custom-li>s3</li>
<li class=custom-li>local</li>
</ul>
<p>Following is an example of disk definitions contained inside a config.</p>
<div class=wrapper_EBtA style=height:603.2px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>&lt;clickhouse>
    &lt;storage_configuration>
        &lt;disks>
            &lt;log_local>
                &lt;type>local&lt;/type>
                &lt;path>/var/lib/clickhouse/coordination/logs/&lt;/path>
            &lt;/log_local>
            &lt;log_s3_plain>
                &lt;type>s3_plain&lt;/type>
                &lt;endpoint>https://some_s3_endpoint/logs/&lt;/endpoint>
                &lt;access_key_id>ACCESS_KEY&lt;/access_key_id>
                &lt;secret_access_key>SECRET_KEY&lt;/secret_access_key>
            &lt;/log_s3_plain>
            &lt;snapshot_local>
                &lt;type>local&lt;/type>
                &lt;path>/var/lib/clickhouse/coordination/snapshots/&lt;/path>
            &lt;/snapshot_local>
            &lt;snapshot_s3_plain>
                &lt;type>s3_plain&lt;/type>
                &lt;endpoint>https://some_s3_endpoint/snapshots/&lt;/endpoint>
                &lt;access_key_id>ACCESS_KEY&lt;/access_key_id>
                &lt;secret_access_key>SECRET_KEY&lt;/secret_access_key>
            &lt;/snapshot_s3_plain>
            &lt;state_s3_plain>
                &lt;type>s3_plain&lt;/type>
                &lt;endpoint>https://some_s3_endpoint/state/&lt;/endpoint>
                &lt;access_key_id>ACCESS_KEY&lt;/access_key_id>
                &lt;secret_access_key>SECRET_KEY&lt;/secret_access_key>
            &lt;/state_s3_plain>
        &lt;/disks>
    &lt;/storage_configuration>
&lt;/clickhouse>
</code></pre></div><div class=activity_PoTP></div></div>
<p>To use a disk for logs <code>keeper_server.log_storage_disk</code> config should be set to the name of disk.
To use a disk for snapshots <code>keeper_server.snapshot_storage_disk</code> config should be set to the name of disk.
Additionally, different disks can be used for the latest logs or snapshots by using <code>keeper_server.latest_log_storage_disk</code> and <code>keeper_server.latest_snapshot_storage_disk</code> respectively.
In that case, Keeper will automatically move files to correct disks when new logs or snapshots are created.
To use a disk for state file, <code>keeper_server.state_storage_disk</code> config should be set to the name of disk.</p>
<p>Moving files between disks is safe and there is no risk of losing data if Keeper stops in the middle of transfer.
Until the file is completely moved to the new disk, it's not deleted from the old one.</p>
<p>Keeper with <code>keeper_server.coordination_settings.force_sync</code> set to <code>true</code> (<code>true</code> by default) can't satisfy some guarantees for all types of disks.
Right now, only disks of type <code>local</code> support persistent sync.
If <code>force_sync</code> is used, <code>log_storage_disk</code> should be a <code>local</code> disk if <code>latest_log_storage_disk</code> isn't used.
If <code>latest_log_storage_disk</code> is used, it should always be a <code>local</code> disk.
If <code>force_sync</code> is disabled, disks of all types can be used in any setup.</p>
<p>A possible storage setup for a Keeper instance could look like following:</p>
<div class=wrapper_EBtA style=height:169.65px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>&lt;clickhouse>
    &lt;keeper_server>
        &lt;log_storage_disk>log_s3_plain&lt;/log_storage_disk>
        &lt;latest_log_storage_disk>log_local&lt;/latest_log_storage_disk>

        &lt;snapshot_storage_disk>snapshot_s3_plain&lt;/snapshot_storage_disk>
        &lt;latest_snapshot_storage_disk>snapshot_local&lt;/latest_snapshot_storage_disk>
    &lt;/keeper_server>
&lt;/clickhouse>
</code></pre></div><div class=activity_PoTP></div></div>
<p>This instance will store all but the latest logs on disk <code>log_s3_plain</code>, while the latest log will be on the <code>log_local</code> disk.
Same logic applies for snapshots, all but the latest snapshots will be stored on <code>snapshot_s3_plain</code>, while the latest snapshot will be on the <code>snapshot_local</code> disk.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=changing-disk-setup>Changing disk setup<a href=#changing-disk-setup class=hash-link aria-label="Direct link to Changing disk setup" title="Direct link to Changing disk setup">​</a></h3>
<div class="theme-admonition theme-admonition-important alert alert--info admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>References</div><p>Before applying a new disk setup, manually back up all Keeper logs and snapshots.</div></div>
<p>If a tiered disk setup is defined (using separate disks for the latest files), Keeper will try to automatically move files to the correct disks on startup.
The same guarantee is applied as before; until the file is completely moved to the new disk, it's not deleted from the old one, so multiple restarts
can be safely done.</p>
<p>If it's necessary to move files to a completely new disk (or move from a 2-disk setup to a single disk setup), it's possible to use multiple definitions of <code>keeper_server.old_snapshot_storage_disk</code> and <code>keeper_server.old_log_storage_disk</code>.</p>
<p>The following config shows how we can move from the previous 2-disk setup to a completely new single-disk setup:</p>
<div class=wrapper_EBtA style=height:207.35000000000002px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>&lt;clickhouse>
    &lt;keeper_server>
        &lt;old_log_storage_disk>log_local&lt;/old_log_storage_disk>
        &lt;old_log_storage_disk>log_s3_plain&lt;/old_log_storage_disk>
        &lt;log_storage_disk>log_local2&lt;/log_storage_disk>

        &lt;old_snapshot_storage_disk>snapshot_s3_plain&lt;/old_snapshot_storage_disk>
        &lt;old_snapshot_storage_disk>snapshot_local&lt;/old_snapshot_storage_disk>
        &lt;snapshot_storage_disk>snapshot_local2&lt;/snapshot_storage_disk>
    &lt;/keeper_server>
&lt;/clickhouse>
</code></pre></div><div class=activity_PoTP></div></div>
<p>On startup, all the log files will be moved from <code>log_local</code> and <code>log_s3_plain</code> to the <code>log_local2</code> disk.
Also, all the snapshot files will be moved from <code>snapshot_local</code> and <code>snapshot_s3_plain</code> to the <code>snapshot_local2</code> disk.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=configuring-logs-cache>Configuring logs cache<a href=#configuring-logs-cache class=hash-link aria-label="Direct link to Configuring logs cache" title="Direct link to Configuring logs cache">​</a></h2>
<p>To minimize the amount of data read from disk, Keeper caches log entries in memory.
If requests are large, log entries will take too much memory so the amount of cached logs is capped.
The limit is controlled with these two configs:</p>
<ul class=custom-ul>
<li class=custom-li><code>latest_logs_cache_size_threshold</code> - total size of latest logs stored in cache</li>
<li class=custom-li><code>commit_logs_cache_size_threshold</code> - total size of subsequent logs that need to be committed next</li>
</ul>
<p>If the default values are too big, you can reduce the memory usage by reducing these two configs.</p>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>Note</div><p>You can use <code>pfev</code> command to check amount of logs read from each cache and from a file.
You can also use metrics from Prometheus endpoint to track the current size of both caches.</div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=prometheus>Prometheus<a href=#prometheus class=hash-link aria-label="Direct link to Prometheus" title="Direct link to Prometheus">​</a></h2>
<p>Keeper can expose metrics data for scraping from <a href=https://prometheus.io target=_blank rel="noopener noreferrer">Prometheus</a>.</p>
<p>Settings:</p>
<ul class=custom-ul>
<li class=custom-li><code>endpoint</code> – HTTP endpoint for scraping metrics by the Prometheus server. Start from '/'.</li>
<li class=custom-li><code>port</code> – Port for <code>endpoint</code>.</li>
<li class=custom-li><code>metrics</code> – Flag that sets to expose metrics from the <a href=/docs/operations/system-tables/metrics>system.metrics</a> table.</li>
<li class=custom-li><code>events</code> – Flag that sets to expose metrics from the <a href=/docs/operations/system-tables/events>system.events</a> table.</li>
<li class=custom-li><code>asynchronous_metrics</code> – Flag that sets to expose current metrics values from the <a href=/docs/operations/system-tables/asynchronous_metrics>system.asynchronous_metrics</a> table.</li>
</ul>
<p><strong>Example</strong></p>
<div class=wrapper_EBtA style=height:263.90000000000003px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>&lt;clickhouse>
    &lt;listen_host>0.0.0.0&lt;/listen_host>
    &lt;http_port>8123&lt;/http_port>
    &lt;tcp_port>9000&lt;/tcp_port>
    &lt;!-- highlight-start -->
    &lt;prometheus>
        &lt;endpoint>/metrics&lt;/endpoint>
        &lt;port>9363&lt;/port>
        &lt;metrics>true&lt;/metrics>
        &lt;events>true&lt;/events>
        &lt;asynchronous_metrics>true&lt;/asynchronous_metrics>
    &lt;/prometheus>
    &lt;!-- highlight-end -->
&lt;/clickhouse>
</code></pre></div><div class=activity_PoTP></div></div>
<p>Check (replace <code>127.0.0.1</code> with the IP addr or hostname of your ClickHouse server):</p>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-bash><code class=language-bash>curl 127.0.0.1:9363/metrics
</code></pre></div><div class=activity_PoTP></div></div>
<p>Please also see the ClickHouse Cloud <a href=/docs/integrations/prometheus>Prometheus integration</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=clickhouse-keeper-user-guide>ClickHouse Keeper user guide<a href=#clickhouse-keeper-user-guide class=hash-link aria-label="Direct link to ClickHouse Keeper user guide" title="Direct link to ClickHouse Keeper user guide">​</a></h2>
<p>This guide provides simple and minimal settings to configure ClickHouse Keeper with an example on how to test distributed operations. This example is performed using 3 nodes on Linux.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1-configure-nodes-with-keeper-settings>1. Configure nodes with Keeper settings<a href=#1-configure-nodes-with-keeper-settings class=hash-link aria-label="Direct link to 1. Configure nodes with Keeper settings" title="Direct link to 1. Configure nodes with Keeper settings">​</a></h3>
<ol class=custom-ol>
<li class=custom-li>
<p>Install 3 ClickHouse instances on 3 hosts (<code>chnode1</code>, <code>chnode2</code>, <code>chnode3</code>). (View the <a href=/docs/install>Quick Start</a> for details on installing ClickHouse.)</p>
</li>
<li class=custom-li>
<p>On each node, add the following entry to allow external communication through the network interface.</p>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>&lt;listen_host>0.0.0.0&lt;/listen_host>
</code></pre></div><div class=activity_PoTP></div></div>
</li>
<li class=custom-li>
<p>Add the following ClickHouse Keeper configuration to all three servers updating the <code>&lt;server_id></code> setting for each server; for <code>chnode1</code> would be <code>1</code>, <code>chnode2</code> would be <code>2</code>, etc.</p>
<div class=wrapper_EBtA style=height:565.5px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>&lt;keeper_server>
    &lt;tcp_port>9181&lt;/tcp_port>
    &lt;server_id>1&lt;/server_id>
    &lt;log_storage_path>/var/lib/clickhouse/coordination/log&lt;/log_storage_path>
    &lt;snapshot_storage_path>/var/lib/clickhouse/coordination/snapshots&lt;/snapshot_storage_path>

    &lt;coordination_settings>
        &lt;operation_timeout_ms>10000&lt;/operation_timeout_ms>
        &lt;session_timeout_ms>30000&lt;/session_timeout_ms>
        &lt;raft_logs_level>warning&lt;/raft_logs_level>
    &lt;/coordination_settings>

    &lt;raft_configuration>
        &lt;server>
            &lt;id>1&lt;/id>
            &lt;hostname>chnode1.domain.com&lt;/hostname>
            &lt;port>9234&lt;/port>
        &lt;/server>
        &lt;server>
            &lt;id>2&lt;/id>
            &lt;hostname>chnode2.domain.com&lt;/hostname>
            &lt;port>9234&lt;/port>
        &lt;/server>
        &lt;server>
            &lt;id>3&lt;/id>
            &lt;hostname>chnode3.domain.com&lt;/hostname>
            &lt;port>9234&lt;/port>
        &lt;/server>
    &lt;/raft_configuration>
&lt;/keeper_server>
</code></pre></div><div class=activity_PoTP></div></div>
<p>These are the basic settings used above:</p>
<table><thead><tr><th>Parameter<th>Description<th>Example<tbody><tr><td>tcp_port<td>port to be used by clients of keeper<td>9181 default equivalent of 2181 as in zookeeper<tr><td>server_id<td>identifier for each ClickHouse Keeper server used in raft configuration<td>1<tr><td>coordination_settings<td>section to parameters such as timeouts<td>timeouts: 10000, log level: trace<tr><td>server<td>definition of server participating<td>list of each server definition<tr><td>raft_configuration<td>settings for each server in the keeper cluster<td>server and settings for each<tr><td>id<td>numeric id of the server for keeper services<td>1<tr><td>hostname<td>hostname, IP or FQDN of each server in the keeper cluster<td><code>chnode1.domain.com</code><tr><td>port<td>port to listen on for interserver keeper connections<td>9234</table>
</li>
<li class=custom-li>
<p>Enable the Zookeeper component. It will use the ClickHouse Keeper engine:</p>
<div class=wrapper_EBtA style=height:263.90000000000003px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>    &lt;zookeeper>
        &lt;node>
            &lt;host>chnode1.domain.com&lt;/host>
            &lt;port>9181&lt;/port>
        &lt;/node>
        &lt;node>
            &lt;host>chnode2.domain.com&lt;/host>
            &lt;port>9181&lt;/port>
        &lt;/node>
        &lt;node>
            &lt;host>chnode3.domain.com&lt;/host>
            &lt;port>9181&lt;/port>
        &lt;/node>
    &lt;/zookeeper>
</code></pre></div><div class=activity_PoTP></div></div>
<p>These are the basic settings used above:</p>
<table><thead><tr><th>Parameter<th>Description<th>Example<tbody><tr><td>node<td>list of nodes for ClickHouse Keeper connections<td>settings entry for each server<tr><td>host<td>hostname, IP or FQDN of each ClickHouse keeper node<td><code>chnode1.domain.com</code><tr><td>port<td>ClickHouse Keeper client port<td>9181</table>
</li>
<li class=custom-li>
<p>Restart ClickHouse and verify that each Keeper instance is running. Execute the following command on each server. The <code>ruok</code> command returns <code>imok</code> if Keeper is running and healthy:</p>
<div class=wrapper_EBtA style=height:37.7px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-bash><code class=language-bash># echo ruok | nc localhost 9181; echo
imok
</code></pre></div><div class=activity_PoTP></div></div>
</li>
<li class=custom-li>
<p>The <code>system</code> database has a table named <code>zookeeper</code> that contains the details of your ClickHouse Keeper instances. Let's view the table:</p>
<div class=wrapper_EBtA style=height:56.550000000000004px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>SELECT *
FROM system.zookeeper
WHERE path IN ('/', '/clickhouse')
</code></pre></div><div class=activity_PoTP></div></div>
<p>The table looks like:</p>
<div class=wrapper_EBtA style=height:94.25px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>┌─name───────┬─value─┬─czxid─┬─mzxid─┬───────────────ctime─┬───────────────mtime─┬─version─┬─cversion─┬─aversion─┬─ephemeralOwner─┬─dataLength─┬─numChildren─┬─pzxid─┬─path────────┐
│ clickhouse │       │   124 │   124 │ 2022-03-07 00:49:34 │ 2022-03-07 00:49:34 │       0 │        2 │        0 │              0 │          0 │           2 │  5693 │ /           │
│ task_queue │       │   125 │   125 │ 2022-03-07 00:49:34 │ 2022-03-07 00:49:34 │       0 │        1 │        0 │              0 │          0 │           1 │   126 │ /clickhouse │
│ tables     │       │  5693 │  5693 │ 2022-03-07 00:49:34 │ 2022-03-07 00:49:34 │       0 │        3 │        0 │              0 │          0 │           3 │  6461 │ /clickhouse │
└────────────┴───────┴───────┴───────┴─────────────────────┴─────────────────────┴─────────┴──────────┴──────────┴────────────────┴────────────┴─────────────┴───────┴─────────────┘
</code></pre></div><div class=activity_PoTP></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2--configure-a-cluster-in-clickhouse>2.  Configure a cluster in ClickHouse<a href=#2--configure-a-cluster-in-clickhouse class=hash-link aria-label="Direct link to 2.  Configure a cluster in ClickHouse" title="Direct link to 2.  Configure a cluster in ClickHouse">​</a></h3>
<ol class=custom-ol>
<li class=custom-li>
<p>Let's configure a simple cluster with 2 shards and only one replica on 2 of the nodes. The third node will be used to achieve a quorum for the requirement in ClickHouse Keeper. Update the configuration on <code>chnode1</code> and <code>chnode2</code>. The following cluster defines 1 shard on each node for a total of 2 shards with no replication. In this example, some of the data will be on node and some will be on the other node:</p>
<div class=wrapper_EBtA style=height:377px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>    &lt;remote_servers>
        &lt;cluster_2S_1R>
            &lt;shard>
                &lt;replica>
                    &lt;host>chnode1.domain.com&lt;/host>
                    &lt;port>9000&lt;/port>
                    &lt;user>default&lt;/user>
                    &lt;password>ClickHouse123!&lt;/password>
                &lt;/replica>
            &lt;/shard>
            &lt;shard>
                &lt;replica>
                    &lt;host>chnode2.domain.com&lt;/host>
                    &lt;port>9000&lt;/port>
                    &lt;user>default&lt;/user>
                    &lt;password>ClickHouse123!&lt;/password>
                &lt;/replica>
            &lt;/shard>
        &lt;/cluster_2S_1R>
    &lt;/remote_servers>
</code></pre></div><div class=activity_PoTP></div></div>
<table><thead><tr><th>Parameter<th>Description<th>Example<tbody><tr><td>shard<td>list of replicas on the cluster definition<td>list of replicas for each shard<tr><td>replica<td>list of settings for each replica<td>settings entries for each replica<tr><td>host<td>hostname, IP or FQDN of server that will host a replica shard<td><code>chnode1.domain.com</code><tr><td>port<td>port used to communicate using the native tcp protocol<td>9000<tr><td>user<td>username that will be used to authenticate to the cluster instances<td>default<tr><td>password<td>password for the user define to allow connections to cluster instances<td><code>ClickHouse123!</code></table>
</li>
<li class=custom-li>
<p>Restart ClickHouse and verify the cluster was created:</p>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-bash><code class=language-bash>SHOW clusters;
</code></pre></div><div class=activity_PoTP></div></div>
<p>You should see your cluster:</p>
<div class=wrapper_EBtA style=height:56.550000000000004px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>┌─cluster───────┐
│ cluster_2S_1R │
└───────────────┘
</code></pre></div><div class=activity_PoTP></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3-create-and-test-distributed-table>3. Create and test distributed table<a href=#3-create-and-test-distributed-table class=hash-link aria-label="Direct link to 3. Create and test distributed table" title="Direct link to 3. Create and test distributed table">​</a></h3>
<ol class=custom-ol>
<li class=custom-li>
<p>Create a new database on the new cluster using ClickHouse client on <code>chnode1</code>. The <code>ON CLUSTER</code> clause automatically creates the database on both nodes.</p>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>CREATE DATABASE db1 ON CLUSTER 'cluster_2S_1R';
</code></pre></div><div class=activity_PoTP></div></div>
</li>
<li class=custom-li>
<p>Create a new table on the <code>db1</code> database. Once again, <code>ON CLUSTER</code> creates the table on both nodes.</p>
<div class=wrapper_EBtA style=height:131.95000000000002px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>CREATE TABLE db1.table1 on cluster 'cluster_2S_1R'
(
    `id` UInt64,
    `column1` String
)
ENGINE = MergeTree
ORDER BY column1
</code></pre></div><div class=activity_PoTP></div></div>
</li>
<li class=custom-li>
<p>On the <code>chnode1</code> node, add a couple of rows:</p>
<div class=wrapper_EBtA style=height:94.25px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>INSERT INTO db1.table1
    (id, column1)
VALUES
    (1, 'abc'),
    (2, 'def')
</code></pre></div><div class=activity_PoTP></div></div>
</li>
<li class=custom-li>
<p>Add a couple of rows on the <code>chnode2</code> node:</p>
<div class=wrapper_EBtA style=height:94.25px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>INSERT INTO db1.table1
    (id, column1)
VALUES
    (3, 'ghi'),
    (4, 'jkl')
</code></pre></div><div class=activity_PoTP></div></div>
</li>
<li class=custom-li>
<p>Notice that running a <code>SELECT</code> statement on each node only shows the data on that node. For example, on <code>chnode1</code>:</p>
<div class=wrapper_EBtA style=height:37.7px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>SELECT *
FROM db1.table1
</code></pre></div><div class=activity_PoTP></div></div>
<div class=wrapper_EBtA style=height:150.8px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>Query id: 7ef1edbc-df25-462b-a9d4-3fe6f9cb0b6d

┌─id─┬─column1─┐
│  1 │ abc     │
│  2 │ def     │
└────┴─────────┘

2 rows in set. Elapsed: 0.006 sec.
</code></pre></div><div class=activity_PoTP></div></div>
<p>On <code>chnode2</code>:</p>
</li>
<li class=custom-li>
<div class=wrapper_EBtA style=height:37.7px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>SELECT *
FROM db1.table1
</code></pre></div><div class=activity_PoTP></div></div>
<div class=wrapper_EBtA style=height:113.10000000000001px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>Query id: c43763cc-c69c-4bcc-afbe-50e764adfcbf

┌─id─┬─column1─┐
│  3 │ ghi     │
│  4 │ jkl     │
└────┴─────────┘
</code></pre></div><div class=activity_PoTP></div></div>
</li>
<li class=custom-li>
<p>You can create a <code>Distributed</code> table to represent the data on the two shards. Tables with the <code>Distributed</code> table engine don't store any data of their own, but allow distributed query processing on multiple servers. Reads hit all the shards, and writes can be distributed across the shards. Run the following query on <code>chnode1</code>:</p>
<div class=wrapper_EBtA style=height:94.25px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>CREATE TABLE db1.dist_table (
    id UInt64,
    column1 String
)
ENGINE = Distributed(cluster_2S_1R,db1,table1)
</code></pre></div><div class=activity_PoTP></div></div>
</li>
<li class=custom-li>
<p>Notice querying <code>dist_table</code> returns all four rows of data from the two shards:</p>
<div class=wrapper_EBtA style=height:37.7px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>SELECT *
FROM db1.dist_table
</code></pre></div><div class=activity_PoTP></div></div>
<div class=wrapper_EBtA style=height:226.20000000000002px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>Query id: 495bffa0-f849-4a0c-aeea-d7115a54747a

┌─id─┬─column1─┐
│  1 │ abc     │
│  2 │ def     │
└────┴─────────┘
┌─id─┬─column1─┐
│  3 │ ghi     │
│  4 │ jkl     │
└────┴─────────┘

4 rows in set. Elapsed: 0.018 sec.
</code></pre></div><div class=activity_PoTP></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=summary>Summary<a href=#summary class=hash-link aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h3>
<p>This guide demonstrated how to set up a cluster using ClickHouse Keeper. With ClickHouse Keeper, you can configure clusters and define distributed tables that can be replicated across shards.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=configuring-clickhouse-keeper-with-unique-paths>Configuring ClickHouse Keeper with unique paths<a href=#configuring-clickhouse-keeper-with-unique-paths class=hash-link aria-label="Direct link to Configuring ClickHouse Keeper with unique paths" title="Direct link to Configuring ClickHouse Keeper with unique paths">​</a></h2>
<div class=cloudNotSupportedBadge_FcNk><div class=cloudNotSupportedIcon_DxHk style=margin-right:8px;margin-top:4px><svg width=16 height=16 viewBox="0 0 16 16" fill=none xmlns=http://www.w3.org/2000/svg><path stroke-width=1.5 d="M6.33366 12.6666L12.3739 12.6667C13.6593 12.6667 14.7073 11.6187 14.7073 10.3334C14.7073 9.04804 13.6593 8.00003 12.3739 8.00003C12.3739 8.00003 12.3337 7.66659 12.0003 7.33325M10.667 5.33322C8.00033 2.33325 4.45395 4.78537 4.14195 6.68203C2.55728 6.7627 1.29395 8.06203 1.29395 9.6667C1.29395 11.3234 2.66699 12.6666 4.00033 12.6666" stroke=#660099 stroke-linecap=round stroke-linejoin=round /><path stroke-width=1.5 d="M2.66699 14L12.0003 4.66663" stroke=#660099 stroke-linecap=round stroke-linejoin=round /></svg></div>Not supported in ClickHouse Cloud</div>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>Note</div><p>This page isn't applicable to <a href=https://clickhouse.com/cloud target=_blank rel="noopener noreferrer">ClickHouse Cloud</a>. The procedure documented here is automated in ClickHouse Cloud services.</div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=description>Description<a href=#description class=hash-link aria-label="Direct link to Description" title="Direct link to Description">​</a></h3>
<p>This article describes how to use the built-in <code>{uuid}</code> macro setting
to create unique entries in ClickHouse Keeper or ZooKeeper. Unique
paths help when creating and dropping tables frequently because
this avoids having to wait several minutes for Keeper garbage collection
to remove path entries as each time a path is created a new <code>uuid</code> is used
in that path; paths are never reused.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=example-environment>Example environment<a href=#example-environment class=hash-link aria-label="Direct link to Example environment" title="Direct link to Example environment">​</a></h3>
<p>A three node cluster that will be configured to have ClickHouse Keeper
on all three nodes, and ClickHouse on two of the nodes. This provides
ClickHouse Keeper with three nodes (including a tiebreaker node), and
a single ClickHouse shard made up of two replicas.</p>
<table><thead><tr><th>node<th>description<tbody><tr><td><code>chnode1.marsnet.local</code><td>data node - cluster <code>cluster_1S_2R</code><tr><td><code>chnode2.marsnet.local</code><td>data node - cluster <code>cluster_1S_2R</code><tr><td><code>chnode3.marsnet.local</code><td>ClickHouse Keeper tie breaker node</table>
<p>Example config for cluster:</p>
<div class=wrapper_EBtA style=height:377px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>    &lt;remote_servers>
        &lt;cluster_1S_2R>
            &lt;shard>
                &lt;replica>
                    &lt;host>chnode1.marsnet.local&lt;/host>
                    &lt;port>9440&lt;/port>
                    &lt;user>default&lt;/user>
                    &lt;password>ClickHouse123!&lt;/password>
                    &lt;secure>1&lt;/secure>
                &lt;/replica>
                &lt;replica>
                    &lt;host>chnode2.marsnet.local&lt;/host>
                    &lt;port>9440&lt;/port>
                    &lt;user>default&lt;/user>
                    &lt;password>ClickHouse123!&lt;/password>
                    &lt;secure>1&lt;/secure>
                &lt;/replica>
            &lt;/shard>
        &lt;/cluster_1S_2R>
    &lt;/remote_servers>
</code></pre></div><div class=activity_PoTP></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=procedures-to-set-up-tables-to-use-uuid>Procedures to set up tables to use <code>{uuid}</code><a href=#procedures-to-set-up-tables-to-use-uuid class=hash-link aria-label="Direct link to procedures-to-set-up-tables-to-use-uuid" title="Direct link to procedures-to-set-up-tables-to-use-uuid">​</a></h3>
<ol class=custom-ol>
<li class=custom-li>Configure Macros on each server
example for server 1:</li>
</ol>
<div class=wrapper_EBtA style=height:75.4px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>    &lt;macros>
        &lt;shard>1&lt;/shard>
        &lt;replica>replica_1&lt;/replica>
    &lt;/macros>
</code></pre></div><div class=activity_PoTP></div></div>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>Note</div><p>Notice that we define macros for <code>shard</code> and <code>replica</code>, but that <code>{uuid}</code> isn't defined here, it is built-in and there is no need to define.</div></div>
<ol class=custom-ol start=2>
<li class=custom-li>Create a Database</li>
</ol>
<div class=wrapper_EBtA style=height:56.550000000000004px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>CREATE DATABASE db_uuid
      ON CLUSTER 'cluster_1S_2R'
      ENGINE Atomic;
</code></pre></div><div class=activity_PoTP></div></div>
<div class=wrapper_EBtA style=height:169.65px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>CREATE DATABASE db_uuid ON CLUSTER cluster_1S_2R
ENGINE = Atomic

Query id: 07fb7e65-beb4-4c30-b3ef-bd303e5c42b5

┌─host──────────────────┬─port─┬─status─┬─error─┬─num_hosts_remaining─┬─num_hosts_active─┐
│ chnode2.marsnet.local │ 9440 │      0 │       │                   1 │                0 │
│ chnode1.marsnet.local │ 9440 │      0 │       │                   0 │                0 │
└───────────────────────┴──────┴────────┴───────┴─────────────────────┴──────────────────┘
</code></pre></div><div class=activity_PoTP></div></div>
<ol class=custom-ol start=3>
<li class=custom-li>Create a table on the cluster using the macros and <code>{uuid}</code></li>
</ol>
<div class=wrapper_EBtA style=height:131.95000000000002px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>CREATE TABLE db_uuid.uuid_table1 ON CLUSTER 'cluster_1S_2R'
   (
     id UInt64,
     column1 String
   )
   ENGINE = ReplicatedMergeTree('/clickhouse/tables/{shard}/db_uuid/{uuid}', '{replica}' )
   ORDER BY (id);
</code></pre></div><div class=activity_PoTP></div></div>
<div class=wrapper_EBtA style=height:263.90000000000003px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>CREATE TABLE db_uuid.uuid_table1 ON CLUSTER cluster_1S_2R
(
    `id` UInt64,
    `column1` String
)
ENGINE = ReplicatedMergeTree('/clickhouse/tables/{shard}/db_uuid/{uuid}', '{replica}')
ORDER BY id

Query id: 8f542664-4548-4a02-bd2a-6f2c973d0dc4

┌─host──────────────────┬─port─┬─status─┬─error─┬─num_hosts_remaining─┬─num_hosts_active─┐
│ chnode1.marsnet.local │ 9440 │      0 │       │                   1 │                0 │
│ chnode2.marsnet.local │ 9440 │      0 │       │                   0 │                0 │
└───────────────────────┴──────┴────────┴───────┴─────────────────────┴──────────────────┘
</code></pre></div><div class=activity_PoTP></div></div>
<ol class=custom-ol start=4>
<li class=custom-li>Create a distributed table</li>
</ol>
<div class=wrapper_EBtA style=height:113.10000000000001px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>CREATE TABLE db_uuid.dist_uuid_table1 ON CLUSTER 'cluster_1S_2R'
   (
     id UInt64,
     column1 String
   )
   ENGINE = Distributed('cluster_1S_2R', 'db_uuid', 'uuid_table1' );
</code></pre></div><div class=activity_PoTP></div></div>
<div class=wrapper_EBtA style=height:245.05px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>CREATE TABLE db_uuid.dist_uuid_table1 ON CLUSTER cluster_1S_2R
(
    `id` UInt64,
    `column1` String
)
ENGINE = Distributed('cluster_1S_2R', 'db_uuid', 'uuid_table1')

Query id: 3bc7f339-ab74-4c7d-a752-1ffe54219c0e

┌─host──────────────────┬─port─┬─status─┬─error─┬─num_hosts_remaining─┬─num_hosts_active─┐
│ chnode2.marsnet.local │ 9440 │      0 │       │                   1 │                0 │
│ chnode1.marsnet.local │ 9440 │      0 │       │                   0 │                0 │
└───────────────────────┴──────┴────────┴───────┴─────────────────────┴──────────────────┘
</code></pre></div><div class=activity_PoTP></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=testing>Testing<a href=#testing class=hash-link aria-label="Direct link to Testing" title="Direct link to Testing">​</a></h3>
<ol class=custom-ol>
<li class=custom-li>Insert data into first node (e.g <code>chnode1</code>)</li>
</ol>
<div class=wrapper_EBtA style=height:75.4px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>INSERT INTO db_uuid.uuid_table1
   ( id, column1)
   VALUES
   ( 1, 'abc');
</code></pre></div><div class=activity_PoTP></div></div>
<div class=wrapper_EBtA style=height:131.95000000000002px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>INSERT INTO db_uuid.uuid_table1 (id, column1) FORMAT Values

Query id: 0f178db7-50a6-48e2-9a1b-52ed14e6e0f9

Ok.

1 row in set. Elapsed: 0.033 sec.
</code></pre></div><div class=activity_PoTP></div></div>
<ol class=custom-ol start=2>
<li class=custom-li>Insert data into second node (e.g., <code>chnode2</code>)</li>
</ol>
<div class=wrapper_EBtA style=height:75.4px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>INSERT INTO db_uuid.uuid_table1
   ( id, column1)
   VALUES
   ( 2, 'def');
</code></pre></div><div class=activity_PoTP></div></div>
<div class=wrapper_EBtA style=height:131.95000000000002px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>INSERT INTO db_uuid.uuid_table1 (id, column1) FORMAT Values

Query id: edc6f999-3e7d-40a0-8a29-3137e97e3607

Ok.

1 row in set. Elapsed: 0.529 sec.
</code></pre></div><div class=activity_PoTP></div></div>
<ol class=custom-ol start=3>
<li class=custom-li>View records using distributed table</li>
</ol>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>SELECT * FROM db_uuid.dist_uuid_table1;
</code></pre></div><div class=activity_PoTP></div></div>
<div class=wrapper_EBtA style=height:245.05px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>SELECT *
FROM db_uuid.dist_uuid_table1

Query id: 6cbab449-9e7f-40fe-b8c2-62d46ba9f5c8

┌─id─┬─column1─┐
│  1 │ abc     │
└────┴─────────┘
┌─id─┬─column1─┐
│  2 │ def     │
└────┴─────────┘

2 rows in set. Elapsed: 0.007 sec.
</code></pre></div><div class=activity_PoTP></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=alternatives>Alternatives<a href=#alternatives class=hash-link aria-label="Direct link to Alternatives" title="Direct link to Alternatives">​</a></h3>
<p>The default replication path can be defined beforehand by macros and using also <code>{uuid}</code></p>
<ol class=custom-ol>
<li class=custom-li>Set default for tables on each node</li>
</ol>
<div class=wrapper_EBtA style=height:37.7px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-xml><code class=language-xml>&lt;default_replica_path>/clickhouse/tables/{shard}/db_uuid/{uuid}&lt;/default_replica_path>
&lt;default_replica_name>{replica}&lt;/default_replica_name>
</code></pre></div><div class=activity_PoTP></div></div>
<div class="theme-admonition theme-admonition-tip alert alert--success admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>Tip</div><p>You can also define a macro <code>{database}</code> on each node if nodes are used for certain databases.</div></div>
<ol class=custom-ol start=2>
<li class=custom-li>Create table without explicit parameters:</li>
</ol>
<div class=wrapper_EBtA style=height:131.95000000000002px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>CREATE TABLE db_uuid.uuid_table1 ON CLUSTER 'cluster_1S_2R'
   (
     id UInt64,
     column1 String
   )
   ENGINE = ReplicatedMergeTree
   ORDER BY (id);
</code></pre></div><div class=activity_PoTP></div></div>
<div class=wrapper_EBtA style=height:301.6px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>CREATE TABLE db_uuid.uuid_table1 ON CLUSTER cluster_1S_2R
(
    `id` UInt64,
    `column1` String
)
ENGINE = ReplicatedMergeTree
ORDER BY id

Query id: ab68cda9-ae41-4d6d-8d3b-20d8255774ee

┌─host──────────────────┬─port─┬─status─┬─error─┬─num_hosts_remaining─┬─num_hosts_active─┐
│ chnode2.marsnet.local │ 9440 │      0 │       │                   1 │                0 │
│ chnode1.marsnet.local │ 9440 │      0 │       │                   0 │                0 │
└───────────────────────┴──────┴────────┴───────┴─────────────────────┴──────────────────┘

2 rows in set. Elapsed: 1.175 sec.
</code></pre></div><div class=activity_PoTP></div></div>
<ol class=custom-ol start=3>
<li class=custom-li>Verify it used the settings used in default config</li>
</ol>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>SHOW CREATE TABLE db_uuid.uuid_table1;
</code></pre></div><div class=activity_PoTP></div></div>
<div class=wrapper_EBtA style=height:207.35000000000002px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>SHOW CREATE TABLE db_uuid.uuid_table1

CREATE TABLE db_uuid.uuid_table1
(
    `id` UInt64,
    `column1` String
)
ENGINE = ReplicatedMergeTree('/clickhouse/tables/{shard}/db_uuid/{uuid}', '{replica}')
ORDER BY id

1 row in set. Elapsed: 0.003 sec.
</code></pre></div><div class=activity_PoTP></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=troubleshooting>Troubleshooting<a href=#troubleshooting class=hash-link aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h3>
<p>Example command to get table information and UUID:</p>
<div class=wrapper_EBtA style=height:37.7px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>SELECT * FROM system.tables
WHERE database = 'db_uuid' AND name = 'uuid_table1';
</code></pre></div><div class=activity_PoTP></div></div>
<p>Example command to get information about the table in zookeeper with UUID for the table above</p>
<div class=wrapper_EBtA style=height:37.7px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>SELECT * FROM system.zookeeper
WHERE path = '/clickhouse/tables/1/db_uuid/9e8a3cc2-0dec-4438-81a7-c3e63ce2a1cf/replicas';
</code></pre></div><div class=activity_PoTP></div></div>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>Note</div><p>Database must be <code>Atomic</code>, if upgrading from a previous version, the
<code>default</code> database is likely of <code>Ordinary</code> type.</div></div>
<p>To check:</p>
<p>For example,</p>
<div class=wrapper_EBtA style=height:18.85px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>SELECT name, engine FROM system.databases WHERE name = 'db_uuid';
</code></pre></div><div class=activity_PoTP></div></div>
<div class=wrapper_EBtA style=height:245.05px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-response><code class=language-response>SELECT
    name,
    engine
FROM system.databases
WHERE name = 'db_uuid'

Query id: b047d459-a1d2-4016-bcf9-3e97e30e49c2

┌─name────┬─engine─┐
│ db_uuid │ Atomic │
└─────────┴────────┘

1 row in set. Elapsed: 0.004 sec.
</code></pre></div><div class=activity_PoTP></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=reconfiguration>ClickHouse Keeper dynamic reconfiguration<a href=#reconfiguration class=hash-link aria-label="Direct link to ClickHouse Keeper dynamic reconfiguration" title="Direct link to ClickHouse Keeper dynamic reconfiguration">​</a></h2>
<div class=cloudNotSupportedBadge_FcNk><div class=cloudNotSupportedIcon_DxHk style=margin-right:8px;margin-top:4px><svg width=16 height=16 viewBox="0 0 16 16" fill=none xmlns=http://www.w3.org/2000/svg><path stroke-width=1.5 d="M6.33366 12.6666L12.3739 12.6667C13.6593 12.6667 14.7073 11.6187 14.7073 10.3334C14.7073 9.04804 13.6593 8.00003 12.3739 8.00003C12.3739 8.00003 12.3337 7.66659 12.0003 7.33325M10.667 5.33322C8.00033 2.33325 4.45395 4.78537 4.14195 6.68203C2.55728 6.7627 1.29395 8.06203 1.29395 9.6667C1.29395 11.3234 2.66699 12.6666 4.00033 12.6666" stroke=#660099 stroke-linecap=round stroke-linejoin=round /><path stroke-width=1.5 d="M2.66699 14L12.0003 4.66663" stroke=#660099 stroke-linecap=round stroke-linejoin=round /></svg></div>Not supported in ClickHouse Cloud</div>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>Note</div><p>This page isn't applicable to <a href=https://clickhouse.com/cloud target=_blank rel="noopener noreferrer">ClickHouse Cloud</a>. The procedure documented here is automated in ClickHouse Cloud services.</div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=description-1>Description<a href=#description-1 class=hash-link aria-label="Direct link to Description" title="Direct link to Description">​</a></h3>
<p>ClickHouse Keeper partially supports ZooKeeper <a href=https://zookeeper.apache.org/doc/r3.5.3-beta/zookeeperReconfig.html#sc_reconfig_modifying target=_blank rel="noopener noreferrer"><code>reconfig</code></a>
command for dynamic cluster reconfiguration if <code>keeper_server.enable_reconfiguration</code> is turned on.</p>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></div><div class="alert-content admonitionContent_vXIg"><div class=admonitionHeading_TMsN>Note</div><p>If this setting is turned off, you may reconfigure the cluster by altering the replica's <code>raft_configuration</code>
section manually. Make sure you the edit files on all replicas as only the leader will apply changes.
Alternatively, you can send a <code>reconfig</code> query through any ZooKeeper-compatible client.</div></div>
<p>A virtual node <code>/keeper/config</code> contains last committed cluster configuration in the following format:</p>
<div class=wrapper_EBtA style=height:56.550000000000004px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-text><code class=language-text>server.id = server_host:server_port[;server_type][;server_priority]
server.id2 = ...
...
</code></pre></div><div class=activity_PoTP></div></div>
<ul class=custom-ul>
<li class=custom-li>Each server entry is delimited by a newline.</li>
<li class=custom-li><code>server_type</code> is either <code>participant</code> or <code>learner</code> (<a href=https://github.com/eBay/NuRaft/blob/master/docs/readonly_member.md target=_blank rel="noopener noreferrer">learner</a> doesn't participate in leader elections).</li>
<li class=custom-li><code>server_priority</code> is a non-negative integer telling <a href=https://github.com/eBay/NuRaft/blob/master/docs/leader_election_priority.md target=_blank rel="noopener noreferrer">which nodes should be prioritised on leader elections</a>.
Priority of 0 means server will never be a leader.</li>
</ul>
<p>Example:</p>
<div class=wrapper_EBtA style=height:75.4px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-sql><code class=language-sql>:) get /keeper/config
server.1=zoo1:9234;participant;1
server.2=zoo2:9234;participant;1
server.3=zoo3:9234;participant;1
</code></pre></div><div class=activity_PoTP></div></div>
<p>You can use <code>reconfig</code> command to add new servers, remove existing ones, and change existing servers'
priorities, here are examples (using <code>clickhouse-keeper-client</code>):</p>
<div class=wrapper_EBtA style=height:113.10000000000001px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-bash><code class=language-bash># Add two new servers
reconfig add "server.5=localhost:123,server.6=localhost:234;learner"
# Remove two other servers
reconfig remove "3,4"
# Change existing server priority to 8
reconfig add "server.5=localhost:5123;participant;8"
</code></pre></div><div class=activity_PoTP></div></div>
<p>And here are examples for <code>kazoo</code>:</p>
<div class=wrapper_EBtA style=height:94.25px><div style=position:absolute;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1px;height:1px;overflow:hidden><pre class=language-python><code class=language-python># Add two new servers, remove two other servers
reconfig(joining="server.5=localhost:123,server.6=localhost:234;learner", leaving="3,4")

# Change existing server priority to 8
reconfig(joining="server.5=localhost:5123;participant;8", leaving=None)
</code></pre></div><div class=activity_PoTP></div></div>
<p>Servers in <code>joining</code> should be in server format described above. Server entries should be delimited by commas.
While adding new servers, you can omit <code>server_priority</code> (default value is 1) and <code>server_type</code> (default value
is <code>participant</code>).</p>
<p>If you want to change existing server priority, add it to <code>joining</code> with target priority.
Server host, port, and type must be equal to existing server configuration.</p>
<p>Servers are added and removed in order of appearance in <code>joining</code> and <code>leaving</code>.
All updates from <code>joining</code> are processed before updates from <code>leaving</code>.</p>
<p>There are some caveats in Keeper reconfiguration implementation:</p>
<ul class=custom-ul>
<li class=custom-li>
<p>Only incremental reconfiguration is supported. Requests with non-empty <code>new_members</code> are declined.</p>
<p>ClickHouse Keeper implementation relies on NuRaft API to change membership dynamically. NuRaft has a way to
add a single server or remove a single server, one at a time. This means each change to configuration
(each part of <code>joining</code>, each part of <code>leaving</code>) must be decided on separately. Thus there is no bulk
reconfiguration available as it would be misleading for end users.</p>
<p>Changing server type (participant/learner) isn't possible either as it's not supported by NuRaft, and
the only way would be to remove and add server, which again would be misleading.</p>
</li>
<li class=custom-li>
<p>You can't use the returned <code>znodestat</code> value.</p>
</li>
<li class=custom-li>
<p>The <code>from_version</code> field isn't used. All requests with set <code>from_version</code> are declined.
This is due to the fact <code>/keeper/config</code> is a virtual node, which means it isn't stored in
persistent storage, but rather generated on-the-fly with the specified node config for every request.
This decision was made as to not duplicate data as NuRaft already stores this config.</p>
</li>
<li class=custom-li>
<p>Unlike ZooKeeper, there is no way to wait on cluster reconfiguration by submitting a <code>sync</code> command.
New config will be <em>eventually</em> applied but with no time guarantees.</p>
</li>
<li class=custom-li>
<p><code>reconfig</code> command may fail for various reasons. You can check cluster's state and see whether the update
was applied.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=converting-a-single-node-keeper-into-a-cluster>Converting a single-node keeper into a cluster<a href=#converting-a-single-node-keeper-into-a-cluster class=hash-link aria-label="Direct link to Converting a single-node keeper into a cluster" title="Direct link to Converting a single-node keeper into a cluster">​</a></h2>
<p>Sometimes it's necessary to extend experimental keeper node into a cluster. Here's a scheme of how to do it step-by-step for 3 nodes cluster:</p>
<ul class=custom-ul>
<li class=custom-li><strong>IMPORTANT</strong>: new nodes must be added in batches less than the current quorum, otherwise they will elect a leader among them. In this example one by one.</li>
<li class=custom-li>The existing keeper node must have <code>keeper_server.enable_reconfiguration</code> configuration parameter turned on.</li>
<li class=custom-li>Start a second node with the full new configuration of keeper cluster.</li>
<li class=custom-li>After it's started, add it to the node 1 using <a href=#reconfiguration><code>reconfig</code></a>.</li>
<li class=custom-li>Now, start a third node and add it using <a href=#reconfiguration><code>reconfig</code></a>.</li>
<li class=custom-li>Update the <code>clickhouse-server</code> configuration by adding new keeper node there and restart it to apply the changes.</li>
<li class=custom-li>Update the raft configuration of the node 1 and, optionally, restart it.</li>
</ul>
<p>To get confident with the process, here's a <a href=https://github.com/ClickHouse/keeper-extend-cluster target=_blank rel="noopener noreferrer">sandbox repository</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=unsupported-features>Unsupported features<a href=#unsupported-features class=hash-link aria-label="Direct link to Unsupported features" title="Direct link to Unsupported features">​</a></h2>
<p>While ClickHouse Keeper aims to be fully compatible with ZooKeeper, there are some features that are currently not implemented (although development is ongoing):</p>
<ul class=custom-ul>
<li class=custom-li><a href=https://zookeeper.apache.org/doc/r3.9.1/apidocs/zookeeper-server/org/apache/zookeeper/ZooKeeper.html#create(java.lang.String,byte%5B%5D,java.util.List,org.apache.zookeeper.CreateMode,org.apache.zookeeper.data.Stat) target=_blank rel="noopener noreferrer"><code>create</code></a> doesn't support returning <code>Stat</code> object</li>
<li class=custom-li><a href=https://zookeeper.apache.org/doc/r3.9.1/apidocs/zookeeper-server/org/apache/zookeeper/ZooKeeper.html#create(java.lang.String,byte%5B%5D,java.util.List,org.apache.zookeeper.CreateMode,org.apache.zookeeper.data.Stat) target=_blank rel="noopener noreferrer"><code>create</code></a>  doesn't support <a href=https://zookeeper.apache.org/doc/r3.9.1/apidocs/zookeeper-server/org/apache/zookeeper/CreateMode.html#PERSISTENT_WITH_TTL target=_blank rel="noopener noreferrer">TTL</a></li>
<li class=custom-li><a href=https://zookeeper.apache.org/doc/r3.9.1/apidocs/zookeeper-server/org/apache/zookeeper/ZooKeeper.html#addWatch(java.lang.String,org.apache.zookeeper.Watcher,org.apache.zookeeper.AddWatchMode) target=_blank rel="noopener noreferrer"><code>addWatch</code></a> doesn't work with <a href=https://zookeeper.apache.org/doc/r3.9.1/apidocs/zookeeper-server/org/apache/zookeeper/AddWatchMode.html#PERSISTENT target=_blank rel="noopener noreferrer"><code>PERSISTENT</code></a> watches</li>
<li class=custom-li><a href=https://zookeeper.apache.org/doc/r3.9.1/apidocs/zookeeper-server/org/apache/zookeeper/ZooKeeper.html#removeWatches(java.lang.String,org.apache.zookeeper.Watcher,org.apache.zookeeper.Watcher.WatcherType,boolean) target=_blank rel="noopener noreferrer"><code>removeWatch</code></a> and <a href=https://zookeeper.apache.org/doc/r3.9.1/apidocs/zookeeper-server/org/apache/zookeeper/ZooKeeper.html#removeAllWatches(java.lang.String,org.apache.zookeeper.Watcher.WatcherType,boolean) target=_blank rel="noopener noreferrer"><code>removeAllWatches</code></a> aren't supported</li>
<li class=custom-li><code>setWatches</code> isn't supported</li>
<li class=custom-li>Creating <a href=https://zookeeper.apache.org/doc/r3.5.1-alpha/api/org/apache/zookeeper/CreateMode.html target=_blank rel="noopener noreferrer"><code>CONTAINER</code></a> type znodes isn't supported</li>
<li class=custom-li><a href=https://cwiki.apache.org/confluence/display/ZOOKEEPER/Zookeeper+and+SASL target=_blank rel="noopener noreferrer"><code>SASL authentication</code></a> isn't supported</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev paginationNavLink_UdUv" href=/docs/guides/separation-storage-compute><svg width=24 height=25 viewBox="0 0 24 25" fill=none xmlns=http://www.w3.org/2000/svg><path d="M9.2751 19.175L10.3251 18.125L5.4501 13.25H21.6001V11.75H5.4501L10.3251 6.87501L9.2751 5.82501L2.5751 12.5L9.2751 19.175Z" fill=currentColor /></svg><div class=paginationNavContent__3xr><div class=pagination-nav__sublabel>Previous</div><div class="paginationNavLabel_YPzM pagination-nav__label">Separation of storage and compute</div></div></a><a class="pagination-nav__link pagination-nav__link--next paginationNavLink_UdUv" href=/docs/guides/sre/network-ports><div class=paginationNavContent__3xr><div class=pagination-nav__sublabel>Next</div><div class="paginationNavLabel_YPzM pagination-nav__label">Network ports</div></div><svg width=24 height=25 viewBox="0 0 24 25" fill=none xmlns=http://www.w3.org/2000/svg><path d="M14.7249 19.175L13.6749 18.125L18.5499 13.25H2.3999V11.75H18.5499L13.6749 6.87501L14.7249 5.82501L21.4249 12.5L14.7249 19.175Z" fill=currentColor /></svg></a></nav></div></div><div class="tocSidebar_cg0C col col--3"><div class="docTOCContainer_yhWY theme-doc-toc-desktop-container"><div class="tableOfContents_bqdL thin-scrollbar docTOC_QrVz theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#implementation-details class="table-of-contents__link toc-highlight">Implementation details</a><li><a href=#configuration class="table-of-contents__link toc-highlight">Configuration</a><li><a href=#how-to-run class="table-of-contents__link toc-highlight">How to run</a><li><a href=#four-letter-word-commands class="table-of-contents__link toc-highlight">Four letter word commands</a><li><a href=#http-control class="table-of-contents__link toc-highlight">HTTP control</a><li><a href=#feature-flags class="table-of-contents__link toc-highlight">Feature flags</a><li><a href=#migration-from-zookeeper class="table-of-contents__link toc-highlight">Migration from ZooKeeper</a><li><a href=#recovering-after-losing-quorum class="table-of-contents__link toc-highlight">Recovering after losing quorum</a><li><a href=#using-disks-with-keeper class="table-of-contents__link toc-highlight">Using disks with Keeper</a><ul><li><a href=#changing-disk-setup class="table-of-contents__link toc-highlight">Changing disk setup</a></ul><li><a href=#configuring-logs-cache class="table-of-contents__link toc-highlight">Configuring logs cache</a><li><a href=#prometheus class="table-of-contents__link toc-highlight">Prometheus</a><li><a href=#clickhouse-keeper-user-guide class="table-of-contents__link toc-highlight">ClickHouse Keeper user guide</a><ul><li><a href=#1-configure-nodes-with-keeper-settings class="table-of-contents__link toc-highlight">1. Configure nodes with Keeper settings</a><li><a href=#2--configure-a-cluster-in-clickhouse class="table-of-contents__link toc-highlight">2.  Configure a cluster in ClickHouse</a><li><a href=#3-create-and-test-distributed-table class="table-of-contents__link toc-highlight">3. Create and test distributed table</a><li><a href=#summary class="table-of-contents__link toc-highlight">Summary</a></ul><li><a href=#configuring-clickhouse-keeper-with-unique-paths class="table-of-contents__link toc-highlight">Configuring ClickHouse Keeper with unique paths</a><ul><li><a href=#description class="table-of-contents__link toc-highlight">Description</a><li><a href=#example-environment class="table-of-contents__link toc-highlight">Example environment</a><li><a href=#procedures-to-set-up-tables-to-use-uuid class="table-of-contents__link toc-highlight">Procedures to set up tables to use <code>{uuid}</code></a><li><a href=#testing class="table-of-contents__link toc-highlight">Testing</a><li><a href=#alternatives class="table-of-contents__link toc-highlight">Alternatives</a><li><a href=#troubleshooting class="table-of-contents__link toc-highlight">Troubleshooting</a></ul><li><a href=#reconfiguration class="table-of-contents__link toc-highlight">ClickHouse Keeper dynamic reconfiguration</a><ul><li><a href=#description-1 class="table-of-contents__link toc-highlight">Description</a></ul><li><a href=#converting-a-single-node-keeper-into-a-cluster class="table-of-contents__link toc-highlight">Converting a single-node keeper into a cluster</a><li><a href=#unsupported-features class="table-of-contents__link toc-highlight">Unsupported features</a></ul></div><div><div class=displayFeedback_Qo8B><div class="sc-1q78udp-0 gXLeMB"><div type=button aria-haspopup=dialog aria-expanded=false aria-controls=radix-:Rlalj5lb6h: data-state=closed class="sc-1dii14g-0 buBXLQ"><div><p class="sc-6r74pj-0 iPDoKp">Was this page helpful?</div><div class="mt-[6px] flex"><div class="Button_OQ45 dark_oAth"><svg width=12 height=12 viewBox="0 0 16 16" fill=none xmlns=http://www.w3.org/2000/svg role=img aria-label=thumbs-up style=display:block;margin:auto><g clip-path=url(#clip0_110_3987)><path d="M2 6.5H5V13H2C1.86739 13 1.74021 12.9473 1.64645 12.8536C1.55268 12.7598 1.5 12.6326 1.5 12.5V7C1.5 6.86739 1.55268 6.74021 1.64645 6.64645C1.74021 6.55268 1.86739 6.5 2 6.5Z" stroke=#B3B6BD stroke-linecap=round stroke-linejoin=round /><path d="M5 6.5L7.5 1.5C8.03043 1.5 8.53914 1.71071 8.91421 2.08579C9.28929 2.46086 9.5 2.96957 9.5 3.5V5H13.5C13.6419 5.00004 13.7821 5.03026 13.9113 5.08865C14.0406 5.14704 14.156 5.23227 14.2498 5.33867C14.3436 5.44507 14.4137 5.57021 14.4555 5.70579C14.4972 5.84136 14.5096 5.98426 14.4919 6.125L13.7419 12.125C13.7114 12.3666 13.5939 12.5888 13.4113 12.7499C13.2286 12.911 12.9935 12.9999 12.75 13H5" stroke=#B3B6BD stroke-linecap=round stroke-linejoin=round /></g><defs><clipPath id=clip0_110_3987><rect width=16 height=16 fill=white /></clipPath></defs></svg></div><div class="Button_OQ45 dark_oAth"><svg width=12 height=12 viewBox="0 0 16 16" fill=none xmlns=http://www.w3.org/2000/svg role=img aria-label=thumbs-down style=display:block;margin:auto><g clip-path=url(#clip0_110_3992)><path d="M2 3H5V9.5H2C1.86739 9.5 1.74021 9.44732 1.64645 9.35355C1.55268 9.25979 1.5 9.13261 1.5 9L1.5 3.5C1.5 3.36739 1.55268 3.24021 1.64645 3.14645C1.74021 3.05268 1.86739 3 2 3Z" stroke=#B3B6BD stroke-linecap=round stroke-linejoin=round /><path d="M5 9.5L7.5 14.5C8.03043 14.5 8.53914 14.2893 8.91421 13.9142C9.28929 13.5391 9.5 13.0304 9.5 12.5V11H13.5C13.6419 11 13.7821 10.9697 13.9113 10.9114C14.0406 10.853 14.156 10.7677 14.2498 10.6613C14.3436 10.5549 14.4137 10.4298 14.4555 10.2942C14.4972 10.1586 14.5096 10.0157 14.4919 9.875L13.7419 3.875C13.7114 3.63339 13.5939 3.41119 13.4113 3.25009C13.2286 3.08899 12.9935 3.00007 12.75 3L5 3" stroke=#B3B6BD stroke-linecap=round stroke-linejoin=round /></g><defs><clipPath id=clip0_110_3992><rect width=16 height=16 fill=white /></clipPath></defs></svg></div></div></div></div></div></div></div></div></div></div></main></div></div><footer class="footer footer_uuN5"><div class="container_gZiR container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>© 2016–2025 ClickHouse, Inc.</div></div><div><div class="footer__links text--center"><div class=footer__links><a href=https://clickhouse.com/legal/trademark-policy target=_blank rel="noopener noreferrer" class=footer__link-item>Trademark</a><span class=footer__link-separator>·</span><a href=https://clickhouse.com/legal/privacy-policy target=_blank rel="noopener noreferrer" class=footer__link-item>Privacy</a><span class=footer__link-separator>·</span><a href=https://trust.clickhouse.com/ target=_blank rel="noopener noreferrer" class=footer__link-item>Security</a><span class=footer__link-separator>·</span><a href=https://clickhouse.com/legal/agreements/terms-of-service target=_blank rel="noopener noreferrer" class=footer__link-item>Terms of Service</a></div></div></div></div></footer><img referrerpolicy=no-referrer-when-downgrade src="https://static.scarf.sh/a.png?x-pxid=e6377503-591b-4886-9398-e69c7fee0b91" alt="" height=0 width=0 style=height:0;width:0><div role=region aria-label="Notifications (F8)" tabindex=-1 style=pointer-events:none><ol tabindex=-1 class="sc-tmc8vl-6 bZUFYN"></ol></div></div><footer class="footer footer_uuN5"><div class="container_gZiR container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>© 2016–2025 ClickHouse, Inc.</div></div><div><div class="footer__links text--center"><div class=footer__links><a href=https://clickhouse.com/legal/trademark-policy target=_blank rel="noopener noreferrer" class=footer__link-item>Trademark</a><span class=footer__link-separator>·</span><a href=https://clickhouse.com/legal/privacy-policy target=_blank rel="noopener noreferrer" class=footer__link-item>Privacy</a><span class=footer__link-separator>·</span><a href=https://trust.clickhouse.com/ target=_blank rel="noopener noreferrer" class=footer__link-item>Security</a><span class=footer__link-separator>·</span><a href=https://clickhouse.com/legal/agreements/terms-of-service target=_blank rel="noopener noreferrer" class=footer__link-item>Terms of Service</a></div></div></div></div></footer><img referrerpolicy=no-referrer-when-downgrade src="https://static.scarf.sh/a.png?x-pxid=e6377503-591b-4886-9398-e69c7fee0b91" alt="" height=0 width=0 style=height:0;width:0></div>